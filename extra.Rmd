```{r}
#pesten collega's
table(NEA2022$pesten_col)


NEA2022 <- NEA2022 %>%
  mutate(pesten_col_plot = recode(pesten_col, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))
table(NEA2022$pesten_col_plot)
summary(NEA2022$pesten_col_plot)

```

```{r}
#pesten leidinggevenden
table(NEA2022$pesten_leid)


NEA2022 <- NEA2022 %>%
  mutate(pesten_leid_plot = recode(pesten_leid, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))
table(NEA2022$pesten_leid_plot)

```

```{r}
#intimidatie collega's
table(NEA2022$intimidation_col)


NEA2022 <- NEA2022 %>%
  mutate(int_col_plot = recode(intimidation_col, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))
table(NEA2022$int_col_plot)

```

```{r}
#intimidatie leidinggevenden
table(NEA2022$intimidation_leid)

NEA2022 <- NEA2022 %>%
  mutate(int_leid_plot = recode(intimidation_leid, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))
table(NEA2022$int_leid_plot)
```
```{r}
#fysiek geweld collega's
table(NEA2022$geweld_col)

NEA2022 <- NEA2022 %>%
  mutate(gew_col_plot = recode(geweld_col, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))
table(NEA2022$gew_col_plot)
```

```{r}
#fysiek geweld leidinggevenden
table(NEA2022$geweld_leid)

NEA2022 <- NEA2022 %>%
  mutate(gew_leid_plot = recode(geweld_leid, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))
table(NEA2022$gew_leid_plot)
```

```{r}
#ongewenste seksuele aandacht collega's
table(NEA2022$seks_col)

NEA2022 <- NEA2022 %>%
  mutate(seks_col_plot = recode(seks_col, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))
table(NEA2022$seks_col_plot)
```
```{r}
#ongewenste seksuele aandacht leidinggevenden
table(NEA2022$seks_leid)

NEA2022 <- NEA2022 %>%
  mutate(seks_leid_plot = recode(seks_leid, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))
table(NEA2022$seks_leid_plot)
```

```{r}
#conflict collega
table(NEA2022$conflict_col)
NEA2022 <- NEA2022 %>%
  mutate(conflict_col_plot = recode(conflict_col, `1` = 0, `2` = 0.50, `3` = 1))
table(NEA2022$conflict_col_plot)
```
```{r}
#conflict leidinggevende
table(NEA2022$conflict_leid)
NEA2022 <- NEA2022 %>%
  mutate(conflict_leid_plot = recode(conflict_leid, `1` = 0, `2` = 0.50, `3` = 1))
table(NEA2022$conflict_leid_plot)
```

```{r}
#conflict werkgever
table(NEA2022$conflict_werk)
NEA2022 <- NEA2022 %>%
  mutate(conflict_werk_plot = recode(conflict_werk, `1` = 0, `2` = 0.50, `3` = 1))
table(NEA2022$conflict_werk_plot)
```

```{r}
summarytools::freq(NEA2022$steunleid_R)

NEA2022 <- NEA2022 %>%
  mutate(steunleid_plot = (steunleid_R - 1) / 6)

summarytools::freq(NEA2022$steunleid_plot)
```
```{r}
summarytools::freq(NEA2022$steuncol_R)

NEA2022 <- NEA2022 %>%
  mutate(steuncol_plot = (steuncol_R - 1) / 6)

summarytools::freq(NEA2022$steuncol_plot)

```

```{r}
summarytools::freq(NEA2022$psyveil_R)

NEA2022 <- NEA2022 %>%
  mutate(psyveil_plot = (psyveil_R - 1) / 16)

summarytools::freq(NEA2022$psyveil_plot)

```
```{r}
summarytools::freq(NEA2022$steuncol_RR)

NEA2022 <- NEA2022 %>%
  mutate(steuncol_plot3 = (steuncol_RR - 1) / 3)

summarytools::freq(NEA2022$steuncol_plot3)
```
```{r}
summarytools::freq(NEA2022$steunleid_RR)

NEA2022 <- NEA2022 %>%
  mutate(steunleid_plot3 = (steunleid_RR - 1) / 3)

summarytools::freq(NEA2022$steunleid_plot3)

```


```{r}
summarytools::freq(NEA2022$psyveil_RR)

NEA2022 <- NEA2022 %>%
  mutate(psyveil_plot3 = (psyveil_RR - 1) / 4)

summarytools::freq(NEA2022$psyveil_plot3)

```

```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class_emp_2 <- model2_emp$predclass
table(NEA2022$class_emp_2)
```
```{r echo=FALSE, message=FALSE, warning=FALSE, include=TRUE, results='hide'}
NEA2022$class_emp_3 <- model3_emp$predclass
table(NEA2022$class_emp_3)
```
```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class_emp_4 <- model4_emp$predclass
table(NEA2022$class_emp_4)
```
```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class_emp_5 <- model5_emp$predclass
table(NEA2022$class_emp_5)
```
```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class_emp_6 <- model6_emp$predclass
table(NEA2022$class_emp_6)
```

```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class_emp_7 <- model7_emp$predclass
table(NEA2022$class_emp_7)
```

```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class_emp_8 <- model8_emp$predclass
table(NEA2022$class_emp_8)
```

```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class_emp_9 <- model9_emp$predclass
table(NEA2022$class_emp_9)
```

```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class_emp_10 <- model10_emp$predclass
table(NEA2022$class_emp_10)
```


```{r, eval=FALSE}
model3_emppred <- model3_emp$predclass
model3_emppost <- model3_emp$posterior

lposteriorsmodel3_emp <- as.list(as.data.frame(model3_emppost))

pmodel3_empv1 <- lposteriorsmodel3_emp[[1]]
pmodel3_empv2 <- lposteriorsmodel3_emp[[2]]
pmodel3_empv3 <- lposteriorsmodel3_emp[[3]]

model4_emppred <- model4_emp$predclass
model4_emppost <- model4_emp$posterior

lposteriorsmodel4_emp <- as.list(as.data.frame(model4_emppost))

pmodel4_empv1 <- lposteriorsmodel4_emp[[1]]
pmodel4_empv2 <- lposteriorsmodel4_emp[[2]]
pmodel4_empv3 <- lposteriorsmodel4_emp[[3]]
pmodel4_empv4 <- lposteriorsmodel4_emp[[4]]


model5_emppred <- model5_emp$predclass
model5_emppost <- model5_emp$posterior

lposteriorsmodel5_emp <- as.list(as.data.frame(model5_emppost))

pmodel5_empv1 <- lposteriorsmodel5_emp[[1]]
pmodel5_empv2 <- lposteriorsmodel5_emp[[2]]
pmodel5_empv3 <- lposteriorsmodel5_emp[[3]]
pmodel5_empv4 <- lposteriorsmodel5_emp[[4]]
pmodel5_empv5 <- lposteriorsmodel5_emp[[5]]

model6_emppred <- model6_emp$predclass
model6_emppost <- model6_emp$posterior

lposteriorsmodel6_emp <- as.list(as.data.frame(model6_emppost))

pmodel6_empv1 <- lposteriorsmodel6_emp[[1]]
pmodel6_empv2 <- lposteriorsmodel6_emp[[2]]
pmodel6_empv3 <- lposteriorsmodel6_emp[[3]]
pmodel6_empv4 <- lposteriorsmodel6_emp[[4]]
pmodel6_empv5 <- lposteriorsmodel6_emp[[5]]
pmodel6_empv6 <- lposteriorsmodel6_emp[[6]]

model7_emppred <- model7_emp$predclass
model7_emppost <- model7_emp$posterior

lposteriorsmodel7_emp <- as.list(as.data.frame(model7_emppost))

pmodel7_empv1 <- lposteriorsmodel7_emp[[1]]
pmodel7_empv2 <- lposteriorsmodel7_emp[[2]]
pmodel7_empv3 <- lposteriorsmodel7_emp[[3]]
pmodel7_empv4 <- lposteriorsmodel7_emp[[4]]
pmodel7_empv5 <- lposteriorsmodel7_emp[[5]]
pmodel7_empv6 <- lposteriorsmodel7_emp[[6]]
pmodel7_empv7 <- lposteriorsmodel7_emp[[7]]

model8_emppred <- model8_emp$predclass
model8_emppost <- model8_emp$posterior

lposteriorsmodel8_emp <- as.list(as.data.frame(model8_emppost))

pmodel8_empv1 <- lposteriorsmodel8_emp[[1]]
pmodel8_empv2 <- lposteriorsmodel8_emp[[2]]
pmodel8_empv3 <- lposteriorsmodel8_emp[[3]]
pmodel8_empv4 <- lposteriorsmodel8_emp[[4]]
pmodel8_empv5 <- lposteriorsmodel8_emp[[5]]
pmodel8_empv6 <- lposteriorsmodel8_emp[[6]]
pmodel8_empv7 <- lposteriorsmodel8_emp[[7]]
pmodel8_empv8 <- lposteriorsmodel8_emp[[8]]

model9_emppred <- model9_emp$predclass
model9_emppost <- model9_emp$posterior

lposteriorsmodel9_emp <- as.list(as.data.frame(model9_emppost))

pmodel9_empv1 <- lposteriorsmodel9_emp[[1]]
pmodel9_empv2 <- lposteriorsmodel9_emp[[2]]
pmodel9_empv3 <- lposteriorsmodel9_emp[[3]]
pmodel9_empv4 <- lposteriorsmodel9_emp[[4]]
pmodel9_empv5 <- lposteriorsmodel9_emp[[5]]
pmodel9_empv6 <- lposteriorsmodel9_emp[[6]]
pmodel9_empv7 <- lposteriorsmodel9_emp[[7]]
pmodel9_empv8 <- lposteriorsmodel9_emp[[8]]
pmodel9_empv9 <- lposteriorsmodel9_emp[[9]]

model10_emppred <- model10_emp$predclass
model10_emppost <- model10_emp$posterior

lposteriorsmodel10_emp <- as.list(as.data.frame(model10_emppost))

pmodel10_empv1 <- lposteriorsmodel10_emp[[1]]
pmodel10_empv2 <- lposteriorsmodel10_emp[[2]]
pmodel10_empv3 <- lposteriorsmodel10_emp[[3]]
pmodel10_empv4 <- lposteriorsmodel10_emp[[4]]
pmodel10_empv5 <- lposteriorsmodel10_emp[[5]]
pmodel10_empv6 <- lposteriorsmodel10_emp[[6]]
pmodel10_empv7 <- lposteriorsmodel10_emp[[7]]
pmodel10_empv8 <- lposteriorsmodel10_emp[[8]]
pmodel10_empv9 <- lposteriorsmodel10_emp[[9]]
pmodel10_empv10 <- lposteriorsmodel10_emp[[10]]

model11_emppred <- model11_emp$predclass
model11_emppost <- model11_emp$posterior

lposteriorsmodel11_emp <- as.list(as.data.frame(model11_emppost))

pmodel11_empv1 <- lposteriorsmodel11_emp[[1]]
pmodel11_empv2 <- lposteriorsmodel11_emp[[2]]
pmodel11_empv3 <- lposteriorsmodel11_emp[[3]]
pmodel11_empv4 <- lposteriorsmodel11_emp[[4]]
pmodel11_empv5 <- lposteriorsmodel11_emp[[5]]
pmodel11_empv6 <- lposteriorsmodel11_emp[[6]]
pmodel11_empv7 <- lposteriorsmodel11_emp[[7]]
pmodel11_empv8 <- lposteriorsmodel11_emp[[8]]
pmodel11_empv9 <- lposteriorsmodel11_emp[[9]]
pmodel11_empv10 <- lposteriorsmodel11_emp[[10]]
pmodel11_empv11 <- lposteriorsmodel11_emp[[11]]

model12_emppred <- model12_emp$predclass
model12_emppost <- model12_emp$posterior

lposteriorsmodel12_emp <- as.list(as.data.frame(model12_emppost))

pmodel12_empv1 <- lposteriorsmodel12_emp[[1]]
pmodel12_empv2 <- lposteriorsmodel12_emp[[2]]
pmodel12_empv3 <- lposteriorsmodel12_emp[[3]]
pmodel12_empv4 <- lposteriorsmodel12_emp[[4]]
pmodel12_empv5 <- lposteriorsmodel12_emp[[5]]
pmodel12_empv6 <- lposteriorsmodel12_emp[[6]]
pmodel12_empv7 <- lposteriorsmodel12_emp[[7]]
pmodel12_empv8 <- lposteriorsmodel12_emp[[8]]
pmodel12_empv9 <- lposteriorsmodel12_emp[[9]]
pmodel12_empv10 <- lposteriorsmodel12_emp[[10]]
pmodel12_empv11 <- lposteriorsmodel12_emp[[11]]
pmodel12_empv12 <- lposteriorsmodel12_emp[[12]]

model13_emppred <- model13_emp$predclass
model13_emppost <- model13_emp$posterior

lposteriorsmodel13_emp <- as.list(as.data.frame(model13_emppost))

pmodel13_empv1 <- lposteriorsmodel13_emp[[1]]
pmodel13_empv2 <- lposteriorsmodel13_emp[[2]]
pmodel13_empv3 <- lposteriorsmodel13_emp[[3]]
pmodel13_empv4 <- lposteriorsmodel13_emp[[4]]
pmodel13_empv5 <- lposteriorsmodel13_emp[[5]]
pmodel13_empv6 <- lposteriorsmodel13_emp[[6]]
pmodel13_empv7 <- lposteriorsmodel13_emp[[7]]
pmodel13_empv8 <- lposteriorsmodel13_emp[[8]]
pmodel13_empv9 <- lposteriorsmodel13_emp[[9]]
pmodel13_empv10 <- lposteriorsmodel13_emp[[10]]
pmodel13_empv11 <- lposteriorsmodel13_emp[[11]]
pmodel13_empv12 <- lposteriorsmodel13_emp[[12]]
pmodel13_empv13 <- lposteriorsmodel13_emp[[13]]

model14_emppred <- model14_emp$predclass
model14_emppost <- model14_emp$posterior

lposteriorsmodel14_emp <- as.list(as.data.frame(model14_emppost))

pmodel14_empv1 <- lposteriorsmodel14_emp[[1]]
pmodel14_empv2 <- lposteriorsmodel14_emp[[2]]
pmodel14_empv3 <- lposteriorsmodel14_emp[[3]]
pmodel14_empv4 <- lposteriorsmodel14_emp[[4]]
pmodel14_empv5 <- lposteriorsmodel14_emp[[5]]
pmodel14_empv6 <- lposteriorsmodel14_emp[[6]]
pmodel14_empv7 <- lposteriorsmodel14_emp[[7]]
pmodel14_empv8 <- lposteriorsmodel14_emp[[8]]
pmodel14_empv9 <- lposteriorsmodel14_emp[[9]]
pmodel14_empv10 <- lposteriorsmodel14_emp[[10]]
pmodel14_empv11 <- lposteriorsmodel14_emp[[11]]
pmodel14_empv12 <- lposteriorsmodel14_emp[[12]]
pmodel14_empv13 <- lposteriorsmodel14_emp[[13]]
pmodel14_empv14 <- lposteriorsmodel14_emp[[14]]
```

```{r, eval=FALSE}
Models_emp <- cbind (volgnumm, model3_emppred	,
                 pmodel3_empv1	,
                 pmodel3_empv2	,
                 pmodel3_empv3	,
                 model4_emppred	,
                 pmodel4_empv1	,
                 pmodel4_empv2	,
                 pmodel4_empv3	,
                 pmodel4_empv4	,
                 model5_emppred	,
                 pmodel5_empv1	,
                 pmodel5_empv2	,
                 pmodel5_empv3	,
                 pmodel5_empv4	,
                 pmodel5_empv5	,
                 model6_emppred	,
                 pmodel6_empv1	,
                 pmodel6_empv2	,
                 pmodel6_empv3	,
                 pmodel6_empv4	,
                 pmodel6_empv5	,
                 pmodel6_empv6	,
                 model7_emppred	,
                 pmodel7_empv1	,
                 pmodel7_empv2	,
                 pmodel7_empv3	,
                 pmodel7_empv4	,
                 pmodel7_empv5	,
                 pmodel7_empv6	,
                 pmodel7_empv7	,
                 model8_emppred	,
                 pmodel8_empv1	,
                 pmodel8_empv2	,
                 pmodel8_empv3	,
                 pmodel8_empv4	,
                 pmodel8_empv5	,
                 pmodel8_empv6	,
                 pmodel8_empv7	,
                 pmodel8_empv8 ,
                 model9_emppred	,
                 pmodel9_empv1	,
                 pmodel9_empv2	,
                 pmodel9_empv3	,
                 pmodel9_empv4	,
                 pmodel9_empv5	,
                 pmodel9_empv6	,
                 pmodel9_empv7	,
                 pmodel9_empv8	,
                 pmodel9_empv9 ,
                 model10_emppred	,
                 pmodel10_empv1 ,
                 pmodel10_empv2 ,
                 pmodel10_empv3 ,
                 pmodel10_empv4 ,
                 pmodel10_empv5 ,
                 pmodel10_empv6 ,
                 pmodel10_empv7 ,
                 pmodel10_empv8 ,
                 pmodel10_empv9 ,
                 pmodel10_empv10 ,
                 model11_emppred	,
                 pmodel11_empv1 ,
                 pmodel11_empv2 ,
                 pmodel11_empv3 ,
                 pmodel11_empv4 ,
                 pmodel11_empv5 ,
                 pmodel11_empv6 ,
                 pmodel11_empv7 ,
                 pmodel11_empv8 ,
                 pmodel11_empv9 ,
                 pmodel11_empv10 ,
                 pmodel11_empv11 ,
                 model12_emppred	,
                 pmodel12_empv1 ,
                 pmodel12_empv2 ,
                 pmodel12_empv3 ,
                 pmodel12_empv4 ,
                 pmodel12_empv5 ,
                 pmodel12_empv6 ,
                 pmodel12_empv7 ,
                 pmodel12_empv8 ,
                 pmodel12_empv9 ,
                 pmodel12_empv10 ,
                 pmodel12_empv11 ,
                 pmodel12_empv12 ,
                 model13_emppred	,
                 pmodel13_empv1 ,
                 pmodel13_empv2 ,
                 pmodel13_empv3 ,
                 pmodel13_empv4 ,
                 pmodel13_empv5 ,
                 pmodel13_empv6 ,
                 pmodel13_empv7 ,
                 pmodel13_empv8 ,
                 pmodel13_empv9 ,
                 pmodel13_empv10 ,
                 pmodel13_empv11 ,
                 pmodel13_empv12 ,
                 pmodel13_empv13 ,
                 model14_emppred	,
                 pmodel14_empv1 ,
                 pmodel14_empv2 ,
                 pmodel14_empv3 ,
                 pmodel14_empv4 ,
                 pmodel14_empv5 ,
                 pmodel14_empv6 ,
                 pmodel14_empv7 ,
                 pmodel14_empv8 ,
                 pmodel14_empv9 ,
                 pmodel14_empv10 ,
                 pmodel14_empv11 ,
                 pmodel14_empv12 ,
                 pmodel14_empv13 ,
                 pmodel14_empv14 )
```

```{r}
sapply(NEA2022, function(x) {
  if (is.character(x) || is.factor(x)) {
    any(is.na(iconv(as.character(x), from = "", to = "UTF-8")))
  } else {
    FALSE
  }
})

```
```{r}
NEA2022[] <- lapply(NEA2022, function(x) {
  if (is.character(x) || is.factor(x)) {
    x <- as.character(x)
    iconv(x, from = "", to = "UTF-8")
  } else {
    x
  }
})

```


```{r}
library(haven)
write_sav(NEA2022, "data/processed/NEA07.sav")
```

```{r}
mean(NEA2022$leeftijd__55.75)
```



```{r}
# Predicted class for each respondent (highest posterior prob)
assigned_class <- apply(model2_emp$posterior, 1, which.max)

# Get number of classes
K <- ncol(model2_emp$posterior)

# Initialize AvePP vector
avepp <- numeric(K)

# Loop through each class to compute AvePP
for (k in 1:K) {
  class_members <- which(assigned_class == k)
  avepp[k] <- mean(model2_emp$posterior[class_members, k])
}

# Print the AvePP per class
round(avepp, 3)
```
```{r}
# Get predicted class for each person (highest posterior prob)
assigned_class <- apply(model3_emp$posterior, 1, which.max)

# Get number of classes
K <- ncol(model3_emp$posterior)

# Initialize AvePP vector
avepp <- numeric(K)

# Loop through each class to compute AvePP
for (k in 1:K) {
  class_members <- which(assigned_class == k)
  avepp[k] <- mean(model3_emp$posterior[class_members, k])
}

# Print the AvePP per class
round(avepp, 3)
```
```{r}
# Get predicted class for each person (highest posterior prob)
assigned_class <- apply(model4_emp$posterior, 1, which.max)

# Get number of classes
K <- ncol(model4_emp$posterior)

# Initialize AvePP vector
avepp <- numeric(K)

# Loop through each class to compute AvePP
for (k in 1:K) {
  class_members <- which(assigned_class == k)
  avepp[k] <- mean(model4_emp$posterior[class_members, k])
}

# Print the AvePP per class
round(avepp, 3)
```
```{r}
# Get predicted class for each person (highest posterior prob)
assigned_class <- apply(model5_emp$posterior, 1, which.max)

# Get number of classes
K <- ncol(model5_emp$posterior)

# Initialize AvePP vector
avepp <- numeric(K)

# Loop through each class to compute AvePP
for (k in 1:K) {
  class_members <- which(assigned_class == k)
  avepp[k] <- mean(model5_emp$posterior[class_members, k])
}

# Print the AvePP per class
round(avepp, 3)
```
```{r}
# Get predicted class for each person (highest posterior prob)
assigned_class <- apply(model6_emp$posterior, 1, which.max)

# Get number of classes
K <- ncol(model6_emp$posterior)

# Initialize AvePP vector
avepp <- numeric(K)

# Loop through each class to compute AvePP
for (k in 1:K) {
  class_members <- which(assigned_class == k)
  avepp[k] <- mean(model6_emp$posterior[class_members, k])
}

# Print the AvePP per class
round(avepp, 3)
```

```{r}
# Get predicted class for each person (highest posterior prob)
assigned_class <- apply(model7_emp$posterior, 1, which.max)

# Get number of classes
K <- ncol(model7_emp$posterior)

# Initialize AvePP vector
avepp <- numeric(K)

# Loop through each class to compute AvePP
for (k in 1:K) {
  class_members <- which(assigned_class == k)
  avepp[k] <- mean(model7_emp$posterior[class_members, k])
}

# Print the AvePP per class
round(avepp, 3)

```
```{r}
# Get predicted class for each person (highest posterior prob)
assigned_class <- apply(model8_emp$posterior, 1, which.max)

# Get number of classes
K <- ncol(model8_emp$posterior)

# Initialize AvePP vector
avepp <- numeric(K)

# Loop through each class to compute AvePP
for (k in 1:K) {
  class_members <- which(assigned_class == k)
  avepp[k] <- mean(model8_emp$posterior[class_members, k])
}

# Print the AvePP per class
round(avepp, 3)
```

```{r}
# Get predicted class for each person (highest posterior prob)
assigned_class <- apply(model9_emp$posterior, 1, which.max)

# Get number of classes
K <- ncol(model9_emp$posterior)

# Initialize AvePP vector
avepp <- numeric(K)

# Loop through each class to compute AvePP
for (k in 1:K) {
  class_members <- which(assigned_class == k)
  avepp[k] <- mean(model9_emp$posterior[class_members, k])
}

# Print the AvePP per class
round(avepp, 3)
```

```{r}
# Get predicted class for each person (highest posterior prob)
assigned_class <- apply(model10_emp$posterior, 1, which.max)

# Get number of classes
K <- ncol(model10_emp$posterior)

# Initialize AvePP vector
avepp <- numeric(K)

# Loop through each class to compute AvePP
for (k in 1:K) {
  class_members <- which(assigned_class == k)
  avepp[k] <- mean(model10_emp$posterior[class_members, k])
}

# Print the AvePP per class
round(avepp, 3)
```

```{r}
# Get predicted class for each person (highest posterior prob)
assigned_class <- apply(model11_emp$posterior, 1, which.max)

# Get number of classes
K <- ncol(model11_emp$posterior)

# Initialize AvePP vector
avepp <- numeric(K)

# Loop through each class to compute AvePP
for (k in 1:K) {
  class_members <- which(assigned_class == k)
  avepp[k] <- mean(model11_emp$posterior[class_members, k])
}

# Print the AvePP per class
round(avepp, 3)
```

```{r}
# Get predicted class for each person (highest posterior prob)
assigned_class <- apply(model12_emp$posterior, 1, which.max)

# Get number of classes
K <- ncol(model12_emp$posterior)

# Initialize AvePP vector
avepp <- numeric(K)

# Loop through each class to compute AvePP
for (k in 1:K) {
  class_members <- which(assigned_class == k)
  avepp[k] <- mean(model12_emp$posterior[class_members, k])
}

# Print the AvePP per class
round(avepp, 3)
```

```{r}
# Get predicted class for each person (highest posterior prob)
assigned_class <- apply(model13_emp$posterior, 1, which.max)

# Get number of classes
K <- ncol(model13_emp$posterior)

# Initialize AvePP vector
avepp <- numeric(K)

# Loop through each class to compute AvePP
for (k in 1:K) {
  class_members <- which(assigned_class == k)
  avepp[k] <- mean(model13_emp$posterior[class_members, k])
}

# Print the AvePP per class
round(avepp, 3)
```







binary:

```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class2_b <- model2_b$predclass
table(NEA2022$class2_b)
```

```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class3_b <- model3_b$predclass
table(NEA2022$class3_b)
```

```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class2_b <- model2_b$predclass
table(NEA2022$class2_b)
```

```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class4_b <- model4_b$predclass
table(NEA2022$class4_b)
```

```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class5_b <- model5_b$predclass
table(NEA2022$class5_b)
```

```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class6_b <- model6_b$predclass
table(NEA2022$class6_b)
```
```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class7_b <- model7_b$predclass
table(NEA2022$class7_b)
```

```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class8_b <- model8_b$predclass
table(NEA2022$class8_b)
```

```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class9_b <- model9_b$predclass
table(NEA2022$class9_b)
```

```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022$class10_b <- model10_b$predclass
table(NEA2022$class10_b)
```

Class 3

```{r, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
tapply(NEA2022$bul_c_plot, NEA2022$class3_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$bul_s_plot, NEA2022$class3_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$int_c_plot, NEA2022$class3_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$int_s_plot, NEA2022$class3_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_c_plot, NEA2022$class3_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_s_plot, NEA2022$class3_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_c_plot, NEA2022$class3_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_s_plot, NEA2022$class3_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_col_plot, NEA2022$class3_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_leid_plot, NEA2022$class3_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$steunleid_plot3, NEA2022$class3_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$steuncol_plot3, NEA2022$class3_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$psyveil_plot3, NEA2022$class3_b, mean, na.rm = TRUE)
```

Class 4

```{r}
tapply(NEA2022$bul_c_plot, NEA2022$class4_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$bul_s_plot, NEA2022$class4_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$int_c_plot, NEA2022$class4_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$int_s_plot, NEA2022$class4_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_c_plot, NEA2022$class4_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_s_plot, NEA2022$class4_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_c_plot, NEA2022$class4_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_s_plot, NEA2022$class4_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_col_plot, NEA2022$class4_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_leid_plot, NEA2022$class4_b, mean, na.rm = TRUE)
```


```{r}
tapply(NEA2022$steunleid_plot3, NEA2022$class4_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$steuncol_plot3, NEA2022$class4_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$psyveil_plot3, NEA2022$class4_b, mean, na.rm = TRUE)
```

Class 5

```{r}
tapply(NEA2022$bul_c_plot, NEA2022$class5_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$bul_s_plot, NEA2022$class5_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$int_c_plot, NEA2022$class5_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$int_s_plot, NEA2022$class5_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_c_plot, NEA2022$class5_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_s_plot, NEA2022$class5_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_c_plot, NEA2022$class5_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_s_plot, NEA2022$class5_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_col_plot, NEA2022$class5_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_leid_plot, NEA2022$class5_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_werk_plot, NEA2022$class5_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$steunleid_plot3, NEA2022$class5_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$steuncol_plot3, NEA2022$class5_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$psyveil_plot3, NEA2022$class5_b, mean, na.rm = TRUE)
```

Class 6

```{r}
tapply(NEA2022$bul_c_plot, NEA2022$class6_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$bul_s_plot, NEA2022$class6_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$int_c_plot, NEA2022$class6_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$int_s_plot, NEA2022$class6_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_c_plot, NEA2022$class6_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_s_plot, NEA2022$class6_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_c_plot, NEA2022$class6_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_s_plot, NEA2022$class6_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_col_plot, NEA2022$class6_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_leid_plot, NEA2022$class6_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_werk_plot, NEA2022$class6_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$steunleid_plot3, NEA2022$class6_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$steuncol_plot3, NEA2022$class6_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$psyveil_plot3, NEA2022$class6_b, mean, na.rm = TRUE)
```

Class 7

```{r}
tapply(NEA2022$bul_c_plot, NEA2022$class7_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$bul_s_plot, NEA2022$class7_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$int_c_plot, NEA2022$class7_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$int_s_plot, NEA2022$class7_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_c_plot, NEA2022$class7_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_s_plot, NEA2022$class7_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_c_plot, NEA2022$class7_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_s_plot, NEA2022$class7_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_col_plot, NEA2022$class7_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_leid_plot, NEA2022$class7_b, mean, na.rm = TRUE)
```


```{r}
tapply(NEA2022$steunleid_plot3, NEA2022$class7_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$steuncol_plot3, NEA2022$class7_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$psyveil_plot3, NEA2022$class7_b, mean, na.rm = TRUE)
```

Class 8

```{r}
tapply(NEA2022$bul_c_plot, NEA2022$class8_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$bul_s_plot, NEA2022$class8_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$int_c_plot, NEA2022$class8_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$int_s_plot, NEA2022$class8_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_c_plot, NEA2022$class8_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_s_plot, NEA2022$class8_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_c_plot, NEA2022$class8_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_s_plot, NEA2022$class8_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_col_plot, NEA2022$class8_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_leid_plot, NEA2022$class8_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_werk_plot, NEA2022$class8_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$steunleid_plot3, NEA2022$class8_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$steuncol_plot3, NEA2022$class8_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$psyveil_plot3, NEA2022$class8_b, mean, na.rm = TRUE)
```

Class 9

```{r}
tapply(NEA2022$bul_c_plot, NEA2022$class9_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$bul_s_plot, NEA2022$class9_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$int_c_plot, NEA2022$class9_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$int_s_plot, NEA2022$class9_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_c_plot, NEA2022$class9_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_s_plot, NEA2022$class9_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_c_plot, NEA2022$class9_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_s_plot, NEA2022$class9_b, mean, na.rm = TRUE)
```
```{r}
tapply(NEA2022$conflict_col_plot, NEA2022$class9_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_leid_plot, NEA2022$class9_b, mean, na.rm = TRUE)
```
```{r}
tapply(NEA2022$steunleid_plot3, NEA2022$class9_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$steuncol_plot3, NEA2022$class9_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$psyveil_plot3, NEA2022$class9_b, mean, na.rm = TRUE)
```
Class 10

```{r}
tapply(NEA2022$bul_c_plot, NEA2022$class10_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$bul_s_plot, NEA2022$class10_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$int_c_plot, NEA2022$class10_b, mean, na.rm = TRUE)
```
```{r}
tapply(NEA2022$int_s_plot, NEA2022$class10_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_c_plot, NEA2022$class10_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$vio_s_plot, NEA2022$class10_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_c_plot, NEA2022$class10_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$sex_s_plot, NEA2022$class10_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_col_plot, NEA2022$class10_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$conflict_leid_plot, NEA2022$class10_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$steunleid_plot3, NEA2022$class10_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$steuncol_plot3, NEA2022$class10_b, mean, na.rm = TRUE)
```

```{r}
tapply(NEA2022$psyveil_plot3, NEA2022$class10_b, mean, na.rm = TRUE)
```



ITEMS PER CLASS

```{r}
library(dplyr)
library(janitor)
library(stringr)

abs_tab <- NEA2022 %>%
  filter(!is.na(class7_b), !is.na(pesten_col)) %>%
  tabyl(class7_b, pesten_col)

pct_tab <- adorn_percentages(abs_tab, "row")

combined_tab <- abs_tab

for (col in names(abs_tab)[-1]) {
  combined_tab[[col]] <- str_glue("{abs_tab[[col]]} ({round(pct_tab[[col]] * 100, 2)}%)")
}

print(combined_tab)

```

```{r}
library(flextable)

flextable(combined_tab) %>%
  autofit() %>%
  theme_booktabs() %>%
  set_caption("Tabel X. Pesten coworkers per class")

```


```{r}
library(dplyr)
library(janitor)
library(stringr)

abs_tab <- NEA2022 %>%
  filter(!is.na(class7_b), !is.na(pesten_leid)) %>%
  tabyl(class7_b, pesten_leid)

pct_tab <- adorn_percentages(abs_tab, "row")
combined_tab <- abs_tab

for (col in names(abs_tab)[-1]) {
  combined_tab[[col]] <- str_glue("{abs_tab[[col]]} ({round(pct_tab[[col]] * 100, 2)}%)")
}

print(combined_tab)

```



```{r}
library(flextable)

flextable(combined_tab) %>%
  autofit() %>%
  theme_booktabs() %>%
  set_caption("Tabel X. Bullying supervisors per class")

```

```{r}
abs_tab <- NEA2022 %>%
  filter(!is.na(class7_b), !is.na(intimidation_col)) %>%
  tabyl(class7_b, intimidation_col)

pct_tab <- adorn_percentages(abs_tab, "row")

combined_tab <- abs_tab

for (col in names(abs_tab)[-1]) {
  combined_tab[[col]] <- str_glue("{abs_tab[[col]]} ({round(pct_tab[[col]] * 100, 2)}%)")
}

print(combined_tab)

```

```{r}
library(flextable)

flextable(combined_tab) %>%
  autofit() %>%
  theme_booktabs() %>%
  set_caption("Tabel X. Intimidation coworkers per class")

```

```{r}
abs_tab <- NEA2022 %>%
  filter(!is.na(class7_b), !is.na(intimidation_leid)) %>%
  tabyl(class7_b, intimidation_leid)

pct_tab <- adorn_percentages(abs_tab, "row")

combined_tab <- abs_tab

for (col in names(abs_tab)[-1]) {
  combined_tab[[col]] <- str_glue("{abs_tab[[col]]} ({round(pct_tab[[col]] * 100, 2)}%)")
}

print(combined_tab)

```

```{r}
library(flextable)

flextable(combined_tab) %>%
  autofit() %>%
  theme_booktabs() %>%
  set_caption("Tabel X. Intimidation supervisors per class")

```


```{r}
abs_tab <- NEA2022 %>%
  filter(!is.na(class7_b), !is.na(seks_col)) %>%
  tabyl(class7_b, seks_col)

pct_tab <- adorn_percentages(abs_tab, "row")
combined_tab <- abs_tab

for (col in names(abs_tab)[-1]) {
  combined_tab[[col]] <- str_glue("{abs_tab[[col]]} ({round(pct_tab[[col]] * 100, 2)}%)")
}

print(combined_tab)

```

```{r}
library(flextable)

flextable(combined_tab) %>%
  autofit() %>%
  theme_booktabs() %>%
  set_caption("Tabel X. Unwanted sexual attention coworkers per class")

```


```{r}
abs_tab <- NEA2022 %>%
  filter(!is.na(class7_b), !is.na(seks_leid)) %>%
  tabyl(class7_b, seks_leid)

pct_tab <- adorn_percentages(abs_tab, "row")
combined_tab <- abs_tab

for (col in names(abs_tab)[-1]) {
  combined_tab[[col]] <- str_glue("{abs_tab[[col]]} ({round(pct_tab[[col]] * 100, 2)}%)")
}

print(combined_tab)

```

```{r}
library(flextable)

flextable(combined_tab) %>%
  autofit() %>%
  theme_booktabs() %>%
  set_caption("Tabel X. Unwanted sexual attention supervisors per class")

```


```{r}
abs_tab <- NEA2022 %>%
  filter(!is.na(class7_b), !is.na(geweld_col)) %>%
  tabyl(class7_b, geweld_col)

pct_tab <- adorn_percentages(abs_tab, "row")
combined_tab <- abs_tab

for (col in names(abs_tab)[-1]) {
  combined_tab[[col]] <- str_glue("{abs_tab[[col]]} ({round(pct_tab[[col]] * 100, 2)}%)")
}

print(combined_tab)

```

```{r}
library(flextable)

flextable(combined_tab) %>%
  autofit() %>%
  theme_booktabs() %>%
  set_caption("Tabel X. Physical violence coworkers per class")

```

```{r}
abs_tab <- NEA2022 %>%
  filter(!is.na(class7_b), !is.na(geweld_leid)) %>%
  tabyl(class7_b, geweld_leid)

pct_tab <- adorn_percentages(abs_tab, "row")

combined_tab <- abs_tab

for (col in names(abs_tab)[-1]) {
  combined_tab[[col]] <- str_glue("{abs_tab[[col]]} ({round(pct_tab[[col]] * 100, 2)}%)")
}

print(combined_tab)

```

```{r}
library(flextable)

flextable(combined_tab) %>%
  autofit() %>%
  theme_booktabs() %>%
  set_caption("Tabel X. Physical violence coworkers per class")

```


```{r}
abs_tab <- NEA2022 %>%
  filter(!is.na(class7_b), !is.na(conflict_col)) %>%
  tabyl(class7_b, conflict_col)

pct_tab <- adorn_percentages(abs_tab, "row")

combined_tab <- abs_tab

for (row in names(abs_tab)[-1]) {
  combined_tab[[row]] <- str_glue("{abs_tab[[row]]} ({round(pct_tab[[row]] * 100, 2)}%)")
}

print(combined_tab)


```

```{r}
library(flextable)

flextable(combined_tab) %>%
  autofit() %>%
  theme_booktabs() %>%
  set_caption("Tabel X. Conflict coworkers per class")

```

```{r}
abs_tab <- NEA2022 %>%
  filter(!is.na(class7_b), !is.na(conflict_leid)) %>%
  tabyl(class7_b, conflict_leid)

pct_tab <- adorn_percentages(abs_tab, "row")

combined_tab <- abs_tab


for (row in names(abs_tab)[-1]) {
  combined_tab[[row]] <- str_glue("{abs_tab[[row]]} ({round(pct_tab[[row]] * 100, 2)}%)")
}

print(combined_tab)


```


```{r}
library(flextable)

flextable(combined_tab) %>%
  autofit() %>%
  theme_booktabs() %>%
  set_caption("Tabel X. Conflict supervisors per class")

```

```{r}
abs_tab <- NEA2022 %>%
  filter(!is.na(class7_b), !is.na(steuncol_RR)) %>%
  tabyl(class7_b, steuncol_RR)

pct_tab <- adorn_percentages(abs_tab, "row")

combined_tab <- abs_tab

for (row in names(abs_tab)[-1]) {
  combined_tab[[row]] <- str_glue("{abs_tab[[row]]} ({round(pct_tab[[row]] * 100, 2)}%)")
}

print(combined_tab)


```

```{r}
library(flextable)

flextable(combined_tab) %>%
  autofit() %>%
  theme_booktabs() %>%
  set_caption("Tabel X. Incivility coworkers per class")

```


```{r}
abs_tab <- NEA2022 %>%
  filter(!is.na(class7_b), !is.na(steunleid_RR)) %>%
  tabyl(class7_b, steunleid_RR)

pct_tab <- adorn_percentages(abs_tab, "row")

combined_tab <- abs_tab

for (row in names(abs_tab)[-1]) {
  combined_tab[[row]] <- str_glue("{abs_tab[[row]]} ({round(pct_tab[[row]] * 100, 2)}%)")
}

print(combined_tab)


```

```{r}
library(flextable)

flextable(combined_tab) %>%
  autofit() %>%
  theme_booktabs() %>%
  set_caption("Tabel X. Incivility supervisors per class")

```


```{r}
abs_tab <- NEA2022 %>%
  filter(!is.na(class7_b), !is.na(psyveil_RR)) %>%
  tabyl(class7_b, psyveil_RR)

pct_tab <- adorn_percentages(abs_tab, "row")

combined_tab <- abs_tab

for (row in names(abs_tab)[-1]) {
  combined_tab[[row]] <- str_glue("{abs_tab[[row]]} ({round(pct_tab[[row]] * 100, 2)}%)")
}

print(combined_tab)


```

```{r}
library(flextable)

flextable(combined_tab) %>%
  autofit() %>%
  theme_booktabs() %>%
  set_caption("Tabel X. Psychological unsafety per class")

```



```{r}
table(NEA2022$class7_b, NEA2022_clust1$classs3_8)
```


```{r}
L_5_i <- lm(model7_5 ~ m.nl.laag.15.35 + v.nl.laag.15.35 + m.eu.laag.15.35 + v.eu.laag.15.35 + m.noeu.laag.15.35 + v.noeu.laag.15.35 + m.nl.middel.15.35 +  v.nl.middel.15.35 + m.eu.middel.15.35 + v.eu.middel.15.35 + m.noeu.middel.15.35 + v.noeu.middel.15.35 + m.nl.hoog.15.35 + v.nl.hoog.15.35 + m.eu.hoog.15.35 + v.eu.hoog.15.35 + m.noeu.hoog.15.35 + v.noeu.hoog.15.35 + m.nl.laag.35.55 + v.nl.laag.35.55 + m.eu.laag.35.55 + v.eu.laag.35.55 + m.noeu.laag.35.55 + v.noeu.laag.35.55 + m.nl.middel.35.55 + v.nl.middel.35.55 + m.eu.middel.35.55 + v.eu.middel.35.55 + m.noeu.middel.35.55 + v.noeu.middel.35.55  + m.nl.hoog.35.55 + v.nl.hoog.35.55 + m.eu.hoog.35.55 + v.eu.hoog.35.55 + m.noeu.hoog.35.55 + v.noeu.hoog.35.55 + m.nl.laag.55.75 + v.nl.laag.55.75 + m.eu.laag.55.75 + v.eu.laag.55.75 + m.noeu.laag.55.75 + v.noeu.laag.55.75 + m.nl.middel.55.75 + v.nl.middel.55.75 + m.eu.middel.55.75 + v.eu.middel.55.75 + m.noeu.middel.55.75 + v.noeu.middel.55.75 + m.nl.hoog.55.75 + v.nl.hoog.55.75 + m.eu.hoog.55.75 + v.eu.hoog.55.75 + m.noeu.hoog.55.75 + v.noeu.hoog.55.75, data=NEA2022)
L_5_i
```
```{r}
tab_model(L_5_i, p.style="stars")
```

```{r}
L_5_s <- lm(model7_5 ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75, data=NEA2022)
L_5_s
```
```{r}
tab_model(L_5_s, p.style="stars")
```


```{r}
L_7_g <- lmer(model7_7 ~ gender_v + (1 | intersections), data=NEA2022)
                
summary(L_7_g)
```

```{r}
L_7_m <- lmer(model7_7 ~ migration_eu + migration_noeu + (1 | intersections), data=NEA2022)
                
summary(L_7_m)
```

```{r}
L_7_e <- lmer(model7_7 ~ education_laag + education_middel + (1 | intersections), data=NEA2022)
                
summary(L_7_e)
```
```{r}
L_7_l <- lmer(model7_7 ~ leeftijd_35.55 + leeftijd_55.75  + (1 | intersections), data=NEA2022)
             
summary(L_7_l)
```





```{r}
L_7_i <- lm(model7_7 ~ m.nl.laag.15.35 + v.nl.laag.15.35 + m.eu.laag.15.35 + v.eu.laag.15.35 + m.noeu.laag.15.35 + v.noeu.laag.15.35 + m.nl.middel.15.35 +  v.nl.middel.15.35 + m.eu.middel.15.35 + v.eu.middel.15.35 + m.noeu.middel.15.35 + v.noeu.middel.15.35 + m.nl.hoog.15.35 + v.nl.hoog.15.35 + m.eu.hoog.15.35 + v.eu.hoog.15.35 + m.noeu.hoog.15.35 + v.noeu.hoog.15.35 + m.nl.laag.35.55 + v.nl.laag.35.55 + m.eu.laag.35.55 + v.eu.laag.35.55 + m.noeu.laag.35.55 + v.noeu.laag.35.55 + m.nl.middel.35.55 + v.nl.middel.35.55 + m.eu.middel.35.55 + v.eu.middel.35.55 + m.noeu.middel.35.55 + v.noeu.middel.35.55  + m.nl.hoog.35.55 + v.nl.hoog.35.55 + m.eu.hoog.35.55 + v.eu.hoog.35.55 + m.noeu.hoog.35.55 + v.noeu.hoog.35.55 + m.nl.laag.55.75 + v.nl.laag.55.75 + m.eu.laag.55.75 + v.eu.laag.55.75 + m.noeu.laag.55.75 + v.noeu.laag.55.75 + m.nl.middel.55.75 + v.nl.middel.55.75 + m.eu.middel.55.75 + v.eu.middel.55.75 + m.noeu.middel.55.75 + v.noeu.middel.55.75 + m.nl.hoog.55.75 + v.nl.hoog.55.75 + m.eu.hoog.55.75 + v.eu.hoog.55.75 + m.noeu.hoog.55.75 + v.noeu.hoog.55.75, data=NEA2022)
L_7_i
```
```{r}
tab_model(L_7_i, p.style="stars")
```

```{r}
L_7_s <- lm(model7_7 ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd_35.55 + leeftijd_55.75, data=NEA2022)
L_7_s
```
```{r}
tab_model(L_7_s, p.style="stars")
```


```{r}
L_1_i <- lm(model7_5 ~ m.nl.laag.15.35 + v.nl.laag.15.35 + m.eu.laag.15.35 + v.eu.laag.15.35 + m.noeu.laag.15.35 + v.noeu.laag.15.35 + m.nl.middel.15.35 +  v.nl.middel.15.35 + m.eu.middel.15.35 + v.eu.middel.15.35 + m.noeu.middel.15.35 + v.noeu.middel.15.35 + m.nl.hoog.15.35 + v.nl.hoog.15.35 + m.eu.hoog.15.35 + v.eu.hoog.15.35 + m.noeu.hoog.15.35 + v.noeu.hoog.15.35 + m.nl.laag.35.55 + v.nl.laag.35.55 + m.eu.laag.35.55 + v.eu.laag.35.55 + m.noeu.laag.35.55 + v.noeu.laag.35.55 + m.nl.middel.35.55 + v.nl.middel.35.55 + m.eu.middel.35.55 + v.eu.middel.35.55 + m.noeu.middel.35.55 + v.noeu.middel.35.55  + m.nl.hoog.35.55 + v.nl.hoog.35.55 + m.eu.hoog.35.55 + v.eu.hoog.35.55 + m.noeu.hoog.35.55 + v.noeu.hoog.35.55 + m.nl.laag.55.75 + v.nl.laag.55.75 + m.eu.laag.55.75 + v.eu.laag.55.75 + m.noeu.laag.55.75 + v.noeu.laag.55.75 + m.nl.middel.55.75 + v.nl.middel.55.75 + m.eu.middel.55.75 + v.eu.middel.55.75 + m.noeu.middel.55.75 + v.noeu.middel.55.75 + m.nl.hoog.55.75 + v.nl.hoog.55.75 + m.eu.hoog.55.75 + v.eu.hoog.55.75 + m.noeu.hoog.55.75 + v.noeu.hoog.55.75, data=NEA2022)
L_1_i
```
```{r}
tab_model(L_1_i, p.style="stars")
```
```{r}
L_1_s <- lm(model7_1 ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd_35.55 + leeftijd_55.75, data=NEA2022)
L_1_s
```



Coworker unsafety (1)


<br><br> **Coworker unsafety (class 1)**


```{r regression overall unsafey, cache=TRUE}
L_1_0 <- lmer(model7_1 ~ 1 + (1|intersections), data=NEA2022) 
                 
summary(L_7_0)

L_1_1 <- lmer(model7_1 ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__15.75  + (1 | intersections), data=NEA2022)
summary(L_1_1)

tab_model(L_1_0, L_1_1, p.style="stars")
```




```{r estimated probability overall unsafety, cache=TRUE}
NEA2022 <- NEA2022 %>%
  mutate(model7_1 = pmodel7_empv5 * 100)

NEA2022$predicted_1 <- predict(L_1_1, re.form = NULL, type = "response")

NEA2022$residual_1 <- NEA2022$model7_1 - NEA2022$predicted_1

summary_preds_1 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd) %>%
  summarise(
    mean_pred_1 = mean(predicted_1, na.rm = TRUE),
    se_pred_1 = sd(residual_1, na.rm = TRUE) / sqrt(n()),
    n = n(),
    .groups = "drop"
  )
summary_preds_1

ggplot(summary_preds_1, aes(x = leeftijd, y = mean_pred_1, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_1 - se_pred_1,
                    ymax = mean_pred_1 + se_pred_1),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )
```





```{r estimated intersectional effects overall unsafety, cache=TRUE}

re <- ranef(L_1_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_1_1, condVar = TRUE)
str(re_with_var)

post_var <- attr(re_with_var$intersections, "postVar")

se <- sqrt(post_var[1, 1, ])

re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)


re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "steelblue",
  re_df$significance == "Disadvantaged" ~ "tomato",
  TRUE ~ "black"
)

re_df

ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects"
  ) +
  theme_minimal()

```

```{r top/bottom 10 overall unsafe model0, cache=TRUE}
pred_df_1 <- NEA2022 %>%
  mutate(
    pred_1 = predict(L_1_0, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_1 = mean(pred_1, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())


list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())


list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```

```{r top/bottom 10 overall unsafe model1, cache=TRUE}
pred_df_1 <- NEA2022 %>%
  mutate(
    pred_1 = predict(L_1_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_1 = mean(pred_1, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())


list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())


list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```






Short-term conflict

```{r}
NEA2022 <- NEA2022 %>%
  mutate(model7_3 = pmodel7_empv3 * 100)
sd(NEA2022$model7_3)
summary(NEA2022$model7_3)
```

```{r}
L_3_0 <- lmer(model7_3 ~ 1 + (1|intersections), data=NEA2022) 
                 
summary(L_3_0)
```
```{r}
L_3_g <- lmer(model7_3 ~ gender_v + (1 | intersections), data=NEA2022)
                
summary(L_3_g)
```
```{r}
L_3_m <- lmer(model7_3 ~ migration_eu + migration_noeu + (1 | intersections), data=NEA2022)
                
summary(L_3_m)
```
```{r}
L_3_e <- lmer(model7_3 ~ education_laag + education_middel + (1 | intersections), data=NEA2022)
                
summary(L_3_e)
```
```{r}
L_3_l <- lmer(model7_3 ~ leeftijd_35.55 + leeftijd_55.75  + (1 | intersections), data=NEA2022)
             
summary(L_3_l)
```
```{r}
L_3_1 <- lmer(model7_3 ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd_35.55 + leeftijd_55.75  + (1 | intersections), data=NEA2022)
summary(L_3_1)
```
```{r}
tab_model(L_3_0, L_3_1, p.style="stars")
```


```{r}
library(dplyr)

NEA2022$predicted_3 <- predict(L_3_0, re.form = NULL, type = "response")

```

```{r}
NEA2022$residual_3 <- NEA2022$model7_3 - NEA2022$predicted_3

```

```{r}
summary_preds_3 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd_) %>%
  summarise(
    mean_pred_3 = mean(predicted_3, na.rm = TRUE),
    se_pred_3 = sd(residual_3, na.rm = TRUE) / sqrt(n()),  # SE van residuals binnen groep
    n = n(),
    .groups = "drop"
  )
summary_preds_3
```



```{r}
ggplot(summary_preds_3, aes(x = leeftijd_, y = mean_pred_3, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_3 - se_pred_3,
                    ymax = mean_pred_3 + se_pred_3),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )

```


```{r}
library(dplyr)

NEA2022$predicted_3 <- predict(L_3_1, re.form = NULL, type = "response")

```

```{r}
NEA2022$residual_3 <- NEA2022$model7_3 - NEA2022$predicted_3

```

```{r}
summary_preds_3 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd_) %>%
  summarise(
    mean_pred_3 = mean(predicted_3, na.rm = TRUE),
    se_pred_3 = sd(residual_3, na.rm = TRUE) / sqrt(n()),  # SE van residuals binnen groep
    n = n(),
    .groups = "drop"
  )
summary_preds_3
```


```{r}
ggplot(summary_preds_3, aes(x = leeftijd_, y = mean_pred_3, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_3 - se_pred_3,
                    ymax = mean_pred_3 + se_pred_3),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )



```





```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_3_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_3_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```


```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "steelblue",
  re_df$significance == "Disadvantaged" ~ "tomato",
  TRUE ~ "black"
)

re_df
```


```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects"
  ) +
  theme_minimal()


```

```{r}
pred_df_3 <- NEA2022 %>%
  mutate(
    pred_3 = predict(L_3_0, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_3 = mean(pred_3, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_3)) %>%
  mutate(rank = row_number())

```



```{r}
list_3 <- pred_df_3 %>%
  arrange(desc(pred_mean_3)) %>%
  mutate(rank = row_number())

top10_3 <- list_3 %>% slice(1:10)
bottom10_3 <- list_3 %>% slice((n() - 9):n())

```
```{r}
list_3 <- bind_rows(
  top10_3 %>% mutate(type = "Top 10"),
  bottom10_3 %>% mutate(type = "Bottom 10")
)

print(list_3)

```
```{r}
pred_df_3 <- NEA2022 %>%
  mutate(
    pred_3 = predict(L_3_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_3 = mean(pred_3, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_3)) %>%
  mutate(rank = row_number())

```



```{r}
list_3 <- pred_df_3 %>%
  arrange(desc(pred_mean_3)) %>%
  mutate(rank = row_number())

top10_3 <- list_3 %>% slice(1:10)
bottom10_3 <- list_3 %>% slice((n() - 9):n())

```
```{r}
list_3 <- bind_rows(
  top10_3 %>% mutate(type = "Top 10"),
  bottom10_3 %>% mutate(type = "Bottom 10")
)

print(list_3)

```

```{r}
L_3_i <- lm(model7_3 ~ m.nl.laag.15.35 + v.nl.laag.15.35 + m.eu.laag.15.35 + v.eu.laag.15.35 + m.noeu.laag.15.35 + v.noeu.laag.15.35 + m.nl.middel.15.35 +  v.nl.middel.15.35 + m.eu.middel.15.35 + v.eu.middel.15.35 + m.noeu.middel.15.35 + v.noeu.middel.15.35 + m.nl.hoog.15.35 + v.nl.hoog.15.35 + m.eu.hoog.15.35 + v.eu.hoog.15.35 + m.noeu.hoog.15.35 + v.noeu.hoog.15.35 + m.nl.laag.35.55 + v.nl.laag.35.55 + m.eu.laag.35.55 + v.eu.laag.35.55 + m.noeu.laag.35.55 + v.noeu.laag.35.55 + m.nl.middel.35.55 + v.nl.middel.35.55 + m.eu.middel.35.55 + v.eu.middel.35.55 + m.noeu.middel.35.55 + v.noeu.middel.35.55  + m.nl.hoog.35.55 + v.nl.hoog.35.55 + m.eu.hoog.35.55 + v.eu.hoog.35.55 + m.noeu.hoog.35.55 + v.noeu.hoog.35.55 + m.nl.laag.55.75 + v.nl.laag.55.75 + m.eu.laag.55.75 + v.eu.laag.55.75 + m.noeu.laag.55.75 + v.noeu.laag.55.75 + m.nl.middel.55.75 + v.nl.middel.55.75 + m.eu.middel.55.75 + v.eu.middel.55.75 + m.noeu.middel.55.75 + v.noeu.middel.55.75 + m.nl.hoog.55.75 + v.nl.hoog.55.75 + m.eu.hoog.55.75 + v.eu.hoog.55.75 + m.noeu.hoog.55.75 + v.noeu.hoog.55.75, data=NEA2022)
L_3_i
```
```{r}
tab_model(L_3_i, p.style="stars")
```
```{r}
L_3_s <- lm(model7_3 ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd_35.55 + leeftijd_55.75, data=NEA2022)
L_3_s
```
```{r}
tab_model(L_3_s, p.style="stars")
```






Safe interpersonal, unsafe social climate


```{r}
NEA2022 <- NEA2022 %>%
  mutate(model7_2 = pmodel7_empv2 * 100)
sd(NEA2022$model7_2)
summary(NEA2022$model7_2)
```

```{r}
L_2_0 <- lmer(model7_2 ~ 1 + (1|intersections), data=NEA2022) 
                 
summary(L_2_0)
```
```{r}
L_2_g <- lmer(model7_2 ~ gender_v + (1 | intersections), data=NEA2022)
                
summary(L_2_g)
```
```{r}
L_2_m <- lmer(model7_2 ~ migration_eu + migration_noeu + (1 | intersections), data=NEA2022)
                
summary(L_2_g)
```
```{r}
L_2_e <- lmer(model7_2 ~ education_laag + education_middel + (1 | intersections), data=NEA2022)
                
summary(L_2_e)
```
```{r}
L_2_l <- lmer(model7_2 ~ leeftijd_35.55 + leeftijd_55.75  + (1 | intersections), data=NEA2022)
             
summary(L_2_l)
```
```{r}
L_2_1 <- lmer(model7_2 ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd_35.55 + leeftijd_55.75  + (1 | intersections), data=NEA2022)
summary(L_2_1)
```
```{r}
tab_model(L_2_0, L_2_1, p.style="stars")
```


```{r}
library(dplyr)

NEA2022$predicted_2 <- predict(L_2_0, re.form = NULL, type = "response")

```

```{r}
NEA2022$residual_2 <- NEA2022$model7_2 - NEA2022$predicted_2

```

```{r}
summary_preds_2 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd_) %>%
  summarise(
    mean_pred_2 = mean(predicted_2, na.rm = TRUE),
    se_pred_2 = sd(residual_2, na.rm = TRUE) / sqrt(n()),  # SE van residuals binnen groep
    n = n(),
    .groups = "drop"
  )
summary_preds_2
```



```{r}
ggplot(summary_preds_2, aes(x = leeftijd_, y = mean_pred_2, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_2 - se_pred_2,
                    ymax = mean_pred_2 + se_pred_2),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )

```


```{r}
library(dplyr)

NEA2022$predicted_2 <- predict(L_2_1, re.form = NULL, type = "response")

```

```{r}
NEA2022$residual_2 <- NEA2022$model7_2 - NEA2022$predicted_2

```

```{r}
summary_preds_2 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd_) %>%
  summarise(
    mean_pred_2 = mean(predicted_2, na.rm = TRUE),
    se_pred_2 = sd(residual_2, na.rm = TRUE) / sqrt(n()),  # SE van residuals binnen groep
    n = n(),
    .groups = "drop"
  )
summary_preds_2
```


```{r}
ggplot(summary_preds_2, aes(x = leeftijd_, y = mean_pred_2, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_2 - se_pred_2,
                    ymax = mean_pred_2 + se_pred_2),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )



```





```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_2_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_2_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```


```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "steelblue",
  re_df$significance == "Disadvantaged" ~ "tomato",
  TRUE ~ "black"
)

re_df
```


```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects"
  ) +
  theme_minimal()


```

```{r}
pred_df_2 <- NEA2022 %>%
  mutate(
    pred_2 = predict(L_2_0, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_2 = mean(pred_2, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_2)) %>%
  mutate(rank = row_number())

```



```{r}
list_2 <- pred_df_2 %>%
  arrange(desc(pred_mean_2)) %>%
  mutate(rank = row_number())

top10_2 <- list_2 %>% slice(1:10)
bottom10_2 <- list_2 %>% slice((n() - 9):n())

```
```{r}
list_2 <- bind_rows(
  top10_2 %>% mutate(type = "Top 10"),
  bottom10_2 %>% mutate(type = "Bottom 10")
)

print(list_2)

```
```{r}
pred_df_2 <- NEA2022 %>%
  mutate(
    pred_2 = predict(L_2_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_2 = mean(pred_2, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_2)) %>%
  mutate(rank = row_number())

```



```{r}
list_2 <- pred_df_2 %>%
  arrange(desc(pred_mean_2)) %>%
  mutate(rank = row_number())

top10_2 <- list_2 %>% slice(1:10)
bottom10_2 <- list_2 %>% slice((n() - 9):n())

```
```{r}
list_2 <- bind_rows(
  top10_2 %>% mutate(type = "Top 10"),
  bottom10_2 %>% mutate(type = "Bottom 10")
)

print(list_2)

```

```{r}
L_2_i <- lm(model7_5 ~ m.nl.laag.15.35 + v.nl.laag.15.35 + m.eu.laag.15.35 + v.eu.laag.15.35 + m.noeu.laag.15.35 + v.noeu.laag.15.35 + m.nl.middel.15.35 +  v.nl.middel.15.35 + m.eu.middel.15.35 + v.eu.middel.15.35 + m.noeu.middel.15.35 + v.noeu.middel.15.35 + m.nl.hoog.15.35 + v.nl.hoog.15.35 + m.eu.hoog.15.35 + v.eu.hoog.15.35 + m.noeu.hoog.15.35 + v.noeu.hoog.15.35 + m.nl.laag.35.55 + v.nl.laag.35.55 + m.eu.laag.35.55 + v.eu.laag.35.55 + m.noeu.laag.35.55 + v.noeu.laag.35.55 + m.nl.middel.35.55 + v.nl.middel.35.55 + m.eu.middel.35.55 + v.eu.middel.35.55 + m.noeu.middel.35.55 + v.noeu.middel.35.55  + m.nl.hoog.35.55 + v.nl.hoog.35.55 + m.eu.hoog.35.55 + v.eu.hoog.35.55 + m.noeu.hoog.35.55 + v.noeu.hoog.35.55 + m.nl.laag.55.75 + v.nl.laag.55.75 + m.eu.laag.55.75 + v.eu.laag.55.75 + m.noeu.laag.55.75 + v.noeu.laag.55.75 + m.nl.middel.55.75 + v.nl.middel.55.75 + m.eu.middel.55.75 + v.eu.middel.55.75 + m.noeu.middel.55.75 + v.noeu.middel.55.75 + m.nl.hoog.55.75 + v.nl.hoog.55.75 + m.eu.hoog.55.75 + v.eu.hoog.55.75 + m.noeu.hoog.55.75 + v.noeu.hoog.55.75, data=NEA2022)
L_2_i
```
```{r}
tab_model(L_2_i, p.style="stars")
```
```{r}
L_2_s <- lm(model7_2 ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd_35.55 + leeftijd_55.75, data=NEA2022)
L_2_s
```
```{r}
tab_model(L_2_s, p.style="stars")
```




Overall safe


```{r}
NEA2022 <- NEA2022 %>%
  mutate(model7_6 = pmodel7_empv6 * 100)
sd(NEA2022$model7_6)
summary(NEA2022$model7_6)
```

```{r}
L_6_0 <- lmer(model7_6 ~ 1 + (1|intersections), data=NEA2022) 
                 
summary(L_6_0)
```
```{r}
L_6_g <- lmer(model7_6 ~ gender_v + (1 | intersections), data=NEA2022)
                
summary(L_6_g)
```
```{r}
L_6_m <- lmer(model7_6 ~ migration_eu + migration_noeu + (1 | intersections), data=NEA2022)
                
summary(L_6_g)
```
```{r}
L_6_e <- lmer(model7_6 ~ education_laag + education_middel + (1 | intersections), data=NEA2022)
                
summary(L_6_e)
```
```{r}
L_6_l <- lmer(model7_6 ~ leeftijd_35.55 + leeftijd_55.75  + (1 | intersections), data=NEA2022)
             
summary(L_6_l)
```
```{r}
L_6_1 <- lmer(model7_6 ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=NEA2022)
summary(L_6_1)
```
```{r}
tab_model(L_6_0, L_6_1, p.style="stars")
```

```{r}
library(dplyr)

NEA2022$predicted_6 <- predict(L_6_0, re.form = NULL, type = "response")

```

```{r}
NEA2022$residual_6 <- NEA2022$model7_6 - NEA2022$predicted_6

```

```{r}
summary_preds_6 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd_) %>%
  summarise(
    mean_pred_6 = mean(predicted_6, na.rm = TRUE),
    se_pred_6 = sd(residual_6, na.rm = TRUE) / sqrt(n()),  # SE van residuals binnen groep
    n = n(),
    .groups = "drop"
  )
summary_preds_6
```



```{r}
ggplot(summary_preds_6, aes(x = leeftijd_, y = mean_pred_6, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_6 - se_pred_6,
                    ymax = mean_pred_6 + se_pred_6),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )

```


```{r}
library(dplyr)

NEA2022$predicted_6 <- predict(L_6_1, re.form = NULL, type = "response")

```

```{r}
NEA2022$residual_6 <- NEA2022$model7_6 - NEA2022$predicted_6

```

```{r}
summary_preds_6 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd_) %>%
  summarise(
    mean_pred_6 = mean(predicted_6, na.rm = TRUE),
    se_pred_6 = sd(residual_6, na.rm = TRUE) / sqrt(n()),  # SE van residuals binnen groep
    n = n(),
    .groups = "drop"
  )
summary_preds_6
```


```{r}
ggplot(summary_preds_6, aes(x = leeftijd_, y = mean_pred_6, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_6 - se_pred_6,
                    ymax = mean_pred_6 + se_pred_6),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )



```





```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_6_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_6_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```


```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "steelblue",
  re_df$significance == "Disadvantaged" ~ "tomato",
  TRUE ~ "black"
)

re_df
```


```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects"
  ) +
  theme_minimal()


```

```{r}
pred_df_6 <- NEA2022 %>%
  mutate(
    pred_6 = predict(L_6_0, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_6 = mean(pred_6, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_6)) %>%
  mutate(rank = row_number())

```



```{r}
list_6 <- pred_df_6 %>%
  arrange(desc(pred_mean_6)) %>%
  mutate(rank = row_number())

top10_6 <- list_6 %>% slice(1:10)
bottom10_6 <- list_6 %>% slice((n() - 9):n())

```
```{r}
list_6 <- bind_rows(
  top10_6 %>% mutate(type = "Top 10"),
  bottom10_6 %>% mutate(type = "Bottom 10")
)

print(list_6)

```
```{r}
pred_df_6 <- NEA2022 %>%
  mutate(
    pred_6 = predict(L_6_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_6 = mean(pred_6, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_6)) %>%
  mutate(rank = row_number())

```



```{r}
list_6 <- pred_df_6 %>%
  arrange(desc(pred_mean_6)) %>%
  mutate(rank = row_number())

top10_6 <- list_6 %>% slice(1:10)
bottom10_6 <- list_6 %>% slice((n() - 9):n())

```
```{r}
list_6 <- bind_rows(
  top10_6 %>% mutate(type = "Top 10"),
  bottom10_6 %>% mutate(type = "Bottom 10")
)

print(list_6)

```

```{r}
L_6_i <- lm(model7_6 ~ m.nl.laag.15.35 + v.nl.laag.15.35 + m.eu.laag.15.35 + v.eu.laag.15.35 + m.noeu.laag.15.35 + v.noeu.laag.15.35 + m.nl.middel.15.35 +  v.nl.middel.15.35 + m.eu.middel.15.35 + v.eu.middel.15.35 + m.noeu.middel.15.35 + v.noeu.middel.15.35 + m.nl.hoog.15.35 + v.nl.hoog.15.35 + m.eu.hoog.15.35 + v.eu.hoog.15.35 + m.noeu.hoog.15.35 + v.noeu.hoog.15.35 + m.nl.laag.35.55 + v.nl.laag.35.55 + m.eu.laag.35.55 + v.eu.laag.35.55 + m.noeu.laag.35.55 + v.noeu.laag.35.55 + m.nl.middel.35.55 + v.nl.middel.35.55 + m.eu.middel.35.55 + v.eu.middel.35.55 + m.noeu.middel.35.55 + v.noeu.middel.35.55  + m.nl.hoog.35.55 + v.nl.hoog.35.55 + m.eu.hoog.35.55 + v.eu.hoog.35.55 + m.noeu.hoog.35.55 + v.noeu.hoog.35.55 + m.nl.laag.55.75 + v.nl.laag.55.75 + m.eu.laag.55.75 + v.eu.laag.55.75 + m.noeu.laag.55.75 + v.noeu.laag.55.75 + m.nl.middel.55.75 + v.nl.middel.55.75 + m.eu.middel.55.75 + v.eu.middel.55.75 + m.noeu.middel.55.75 + v.noeu.middel.55.75 + m.nl.hoog.55.75 + v.nl.hoog.55.75 + m.eu.hoog.55.75 + v.eu.hoog.55.75 + m.noeu.hoog.55.75 + v.noeu.hoog.55.75, data=NEA2022)
L_6_i
```
```{r}
tab_model(L_6_i, p.style="stars")
```
```{r}
L_6_s <- lm(model7_6 ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd_35.55 + leeftijd_55.75, data=NEA2022)
L_6_s
```
```{r}
tab_model(L_6_s, p.style="stars")
```



Overall highly safe


```{r}
NEA2022 <- NEA2022 %>%
  mutate(model7_4 = pmodel7_empv4 * 100)
sd(NEA2022$model7_4)
summary(NEA2022$model7_4)
```

```{r}
L_4_0 <- lmer(model7_4 ~ 1 + (1|intersections), data=NEA2022) 
                 
summary(L_4_0)
```
```{r}
L_4_g <- lmer(model7_4 ~ gender_v + (1 | intersections), data=NEA2022)
                
summary(L_4_g)
```
```{r}
L_4_m <- lmer(model7_4 ~ migration_eu + migration_noeu + (1 | intersections), data=NEA2022)
                
summary(L_4_g)
```
```{r}
L_4_e <- lmer(model7_4 ~ education_laag + education_middel + (1 | intersections), data=NEA2022)
                
summary(L_4_e)
```
```{r}
L_4_l <- lmer(model7_4 ~ leeftijd_35.55 + leeftijd_55.75  + (1 | intersections), data=NEA2022)
             
summary(L_4_l)
```
```{r}
L_4_1 <- lmer(model7_4 ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd_35.55 + leeftijd_55.75  + (1 | intersections), data=NEA2022)
summary(L_4_1)
```
```{r}
tab_model(L_4_0, L_4_1, p.style="stars")
```


```{r}
library(dplyr)

NEA2022$predicted_4 <- predict(L_4_0, re.form = NULL, type = "response")

```

```{r}
NEA2022$residual_4 <- NEA2022$model7_4 - NEA2022$predicted_4

```

```{r}
summary_preds_4 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd_) %>%
  summarise(
    mean_pred_4 = mean(predicted_4, na.rm = TRUE),
    se_pred_4 = sd(residual_4, na.rm = TRUE) / sqrt(n()),  # SE van residuals binnen groep
    n = n(),
    .groups = "drop"
  )
summary_preds_4
```



```{r}
ggplot(summary_preds_4, aes(x = leeftijd_, y = mean_pred_4, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_4 - se_pred_4,
                    ymax = mean_pred_4 + se_pred_4),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )

```


```{r}
library(dplyr)

NEA2022$predicted_4 <- predict(L_4_1, re.form = NULL, type = "response")

```

```{r}
NEA2022$residual_4 <- NEA2022$model7_4 - NEA2022$predicted_4

```

```{r}
summary_preds_4 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd_) %>%
  summarise(
    mean_pred_4 = mean(predicted_4, na.rm = TRUE),
    se_pred_4 = sd(residual_4, na.rm = TRUE) / sqrt(n()),  # SE van residuals binnen groep
    n = n(),
    .groups = "drop"
  )
summary_preds_4
```


```{r}
ggplot(summary_preds_4, aes(x = leeftijd_, y = mean_pred_4, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_4 - se_pred_4,
                    ymax = mean_pred_4 + se_pred_4),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )



```





```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_4_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_4_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```


```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "steelblue",
  re_df$significance == "Disadvantaged" ~ "tomato",
  TRUE ~ "black"
)

re_df
```


```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects"
  ) +
  theme_minimal()


```

```{r}
pred_df_4 <- NEA2022 %>%
  mutate(
    pred_4 = predict(L_4_0, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_4 = mean(pred_4, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_4)) %>%
  mutate(rank = row_number())

```



```{r}
list_4 <- pred_df_4 %>%
  arrange(desc(pred_mean_4)) %>%
  mutate(rank = row_number())

top10_4 <- list_4 %>% slice(1:10)
bottom10_4 <- list_4 %>% slice((n() - 9):n())

```
```{r}
list_4 <- bind_rows(
  top10_4 %>% mutate(type = "Top 10"),
  bottom10_4 %>% mutate(type = "Bottom 10")
)

print(list_4)

```
```{r}
pred_df_4 <- NEA2022 %>%
  mutate(
    pred_4 = predict(L_4_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_4 = mean(pred_4, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_4)) %>%
  mutate(rank = row_number())

```



```{r}
list_4 <- pred_df_4 %>%
  arrange(desc(pred_mean_4)) %>%
  mutate(rank = row_number())

top10_4 <- list_4 %>% slice(1:10)
bottom10_4 <- list_4 %>% slice((n() - 9):n())

```
```{r}
list_4 <- bind_rows(
  top10_4 %>% mutate(type = "Top 10"),
  bottom10_4 %>% mutate(type = "Bottom 10")
)

print(list_4)

```

```{r}
L_4_i <- lm(model7_4 ~ m.nl.laag.15.35 + v.nl.laag.15.35 + m.eu.laag.15.35 + v.eu.laag.15.35 + m.noeu.laag.15.35 + v.noeu.laag.15.35 + m.nl.middel.15.35 +  v.nl.middel.15.35 + m.eu.middel.15.35 + v.eu.middel.15.35 + m.noeu.middel.15.35 + v.noeu.middel.15.35 + m.nl.hoog.15.35 + v.nl.hoog.15.35 + m.eu.hoog.15.35 + v.eu.hoog.15.35 + m.noeu.hoog.15.35 + v.noeu.hoog.15.35 + m.nl.laag.35.55 + v.nl.laag.35.55 + m.eu.laag.35.55 + v.eu.laag.35.55 + m.noeu.laag.35.55 + v.noeu.laag.35.55 + m.nl.middel.35.55 + v.nl.middel.35.55 + m.eu.middel.35.55 + v.eu.middel.35.55 + m.noeu.middel.35.55 + v.noeu.middel.35.55  + m.nl.hoog.35.55 + v.nl.hoog.35.55 + m.eu.hoog.35.55 + v.eu.hoog.35.55 + m.noeu.hoog.35.55 + v.noeu.hoog.35.55 + m.nl.laag.55.75 + v.nl.laag.55.75 + m.eu.laag.55.75 + v.eu.laag.55.75 + m.noeu.laag.55.75 + v.noeu.laag.55.75 + m.nl.middel.55.75 + v.nl.middel.55.75 + m.eu.middel.55.75 + v.eu.middel.55.75 + m.noeu.middel.55.75 + v.noeu.middel.55.75 + m.nl.hoog.55.75 + v.nl.hoog.55.75 + m.eu.hoog.55.75 + v.eu.hoog.55.75 + m.noeu.hoog.55.75 + v.noeu.hoog.55.75, data=NEA2022)
L_4_i
```
```{r}
tab_model(L_4_i, p.style="stars")
```
```{r}
L_4_s <- lm(model7_4 ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd_35.55 + leeftijd_55.75, data=NEA2022)
L_4_s
```
```{r}
tab_model(L_4_s, p.style="stars")
```







```{r}
tab_model(Maihdab_conflict_0, Maihdab_conflict_1, p.style="stars")
```



```{r}
library(dplyr)

NEA2022$predicted_conflict <- predict(Maihdab_conflict_1, re.form = NULL, type = "response")

```

```{r}
NEA2022$residual_conflict <- NEA2022$pconflict - NEA2022$predicted_conflict

```

```{r}
summary_preds_1 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd_) %>%
  summarise(
    mean_pred_1 = mean(predicted_conflict, na.rm = TRUE),
    se_pred_1 = sd(residual_conflict, na.rm = TRUE) / sqrt(n()),  # SE van residuals binnen groep
    n = n(),
    .groups = "drop"
  )
summary_preds_1
```


```{r}
ggplot(summary_preds_1, aes(x = leeftijd_, y = mean_pred_1, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_1 - se_pred_1,
                    ymax = mean_pred_1 + se_pred_1),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )



```





```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(Maihdab_conflict_1, condVar = TRUE)$intersections

re_with_var <- ranef(Maihdab_conflict_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```


```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "steelblue",
  re_df$significance == "Disadvantaged" ~ "tomato",
  TRUE ~ "black"
)

re_df
```


```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects"
  ) +
  theme_minimal()


```



```{r}
list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())

```
```{r}
list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```
```{r}
pred_df_1 <- NEA2022 %>%
  mutate(
    pred_1 = predict(Maihdab_conflict_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_1 = mean(pred_1, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

```



```{r}
list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())

```
```{r}
list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```

SUPERVISOR UNSAFETY


```{r}
NEA2022$psuper <-pmodel7_bv2*100
```



```{r}
Maihdab_super_0 <- lmer(psuper ~ 1 + (1|intersections), data=NEA2022) 
summary(Maihdab_super_0)
confint(Maihdab_super_0)
```
```{r}
Maihdab_super_1 <- lmer(psuper ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=NEA2022)
summary(Maihdab_super_1)
```

```{r}
tab_model(Maihdab_super_0, Maihdab_super_1, p.style="stars")
```



```{r}
library(dplyr)

NEA2022$predicted_super <- predict(Maihdab_super_1, re.form = NULL, type = "response")

```

```{r}
NEA2022$residual_super <- NEA2022$psuper - NEA2022$predicted_super

```

```{r}
summary_preds_1 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd_) %>%
  summarise(
    mean_pred_1 = mean(predicted_super, na.rm = TRUE),
    se_pred_1 = sd(residual_super, na.rm = TRUE) / sqrt(n()),  # SE van residuals binnen groep
    n = n(),
    .groups = "drop"
  )
summary_preds_1
```


```{r}
ggplot(summary_preds_1, aes(x = leeftijd_, y = mean_pred_1, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_1 - se_pred_1,
                    ymax = mean_pred_1 + se_pred_1),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )



```





```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(Maihdab_super_1, condVar = TRUE)$intersections

re_with_var <- ranef(Maihdab_super_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```


```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "steelblue",
  re_df$significance == "Disadvantaged" ~ "tomato",
  TRUE ~ "black"
)

re_df
```


```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects"
  ) +
  theme_minimal()


```



```{r}
list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())

```
```{r}
list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```
```{r}
pred_df_1 <- NEA2022 %>%
  mutate(
    pred_1 = predict(Maihdab_super_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_1 = mean(pred_1, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

```



```{r}
list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())

```
```{r}
list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```

COWORKER UNSAFETY


```{r}
NEA2022$pcow <-pmodel7_bv3*100
```



```{r}
Maihdab_cow_0 <- lmer(pcow ~ 1 + (1|intersections), data=NEA2022) 
summary(Maihdab_cow_0)
confint(Maihdab_cow_0)
```
```{r}
Maihdab_cow_1 <- lmer(pcow ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=NEA2022)
summary(Maihdab_cow_1)
```

```{r}
tab_model(Maihdab_cow_0, Maihdab_cow_1, p.style="stars")
```



```{r}
library(dplyr)

NEA2022$predicted_cow <- predict(Maihdab_cow_1, re.form = NULL, type = "response")

```

```{r}
NEA2022$residual_cow <- NEA2022$pcow - NEA2022$predicted_cow

```

```{r}
summary_preds_1 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd_) %>%
  summarise(
    mean_pred_1 = mean(predicted_cow, na.rm = TRUE),
    se_pred_1 = sd(residual_cow, na.rm = TRUE) / sqrt(n()),  # SE van residuals binnen groep
    n = n(),
    .groups = "drop"
  )
summary_preds_1
```


```{r}
ggplot(summary_preds_1, aes(x = leeftijd_, y = mean_pred_1, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_1 - se_pred_1,
                    ymax = mean_pred_1 + se_pred_1),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )



```





```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(Maihdab_cow_1, condVar = TRUE)$intersections

re_with_var <- ranef(Maihdab_cow_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```


```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "steelblue",
  re_df$significance == "Disadvantaged" ~ "tomato",
  TRUE ~ "black"
)

re_df
```


```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects"
  ) +
  theme_minimal()


```



```{r}
list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())

```
```{r}
list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```
```{r}
pred_df_1 <- NEA2022 %>%
  mutate(
    pred_1 = predict(Maihdab_cow_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_1 = mean(pred_1, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

```



```{r}
list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())

```
```{r}
list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```





UNSAFE SOCIAL CLIMATE


```{r}
NEA2022$pclim <-pmodel7_bv4*100
```



```{r}
Maihdab_clim_0 <- lmer(pclim ~ 1 + (1|intersections), data=NEA2022) 
summary(Maihdab_clim_0)
confint(Maihdab_clim_0)
```
```{r}
Maihdab_clim_1 <- lmer(pclim ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=NEA2022)
summary(Maihdab_clim_1)
```

```{r}
tab_model(Maihdab_clim_0, Maihdab_clim_1, p.style="stars")
```



```{r}
library(dplyr)

NEA2022$predicted_clim <- predict(Maihdab_clim_1, re.form = NULL, type = "response")

```

```{r}
NEA2022$residual_clim <- NEA2022$pclim - NEA2022$predicted_clim

```

```{r}
summary_preds_1 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd_) %>%
  summarise(
    mean_pred_1 = mean(predicted_clim, na.rm = TRUE),
    se_pred_1 = sd(residual_clim, na.rm = TRUE) / sqrt(n()),  # SE van residuals binnen groep
    n = n(),
    .groups = "drop"
  )
summary_preds_1
```


```{r}
ggplot(summary_preds_1, aes(x = leeftijd_, y = mean_pred_1, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_1 - se_pred_1,
                    ymax = mean_pred_1 + se_pred_1),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )



```





```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(Maihdab_clim_1, condVar = TRUE)$intersections

re_with_var <- ranef(Maihdab_clim_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```


```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "steelblue",
  re_df$significance == "Disadvantaged" ~ "tomato",
  TRUE ~ "black"
)

re_df
```


```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects"
  ) +
  theme_minimal()


```



```{r}
list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())

```
```{r}
list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```
```{r}
pred_df_1 <- NEA2022 %>%
  mutate(
    pred_1 = predict(Maihdab_clim_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_1 = mean(pred_1, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

```



```{r}
list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())

```
```{r}
list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```



OVERALL SAFE


```{r}
NEA2022$psafe <-pmodel7_bv5*100
```



```{r}
Maihdab_safe_0 <- lmer(psafe ~ 1 + (1|intersections), data=NEA2022) 
summary(Maihdab_safe_0)
confint(Maihdab_safe_0)
```
```{r}
Maihdab_safe_1 <- lmer(psafe ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=NEA2022)
summary(Maihdab_safe_1)
```

```{r}
tab_model(Maihdab_safe_0, Maihdab_safe_1, p.style="stars")
```



```{r}
library(dplyr)

NEA2022$predicted_safe <- predict(Maihdab_safe_1, re.form = NULL, type = "response")

```

```{r}
NEA2022$residual_safe <- NEA2022$psafe - NEA2022$predicted_safe

```

```{r}
summary_preds_1 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd_) %>%
  summarise(
    mean_pred_1 = mean(predicted_safe, na.rm = TRUE),
    se_pred_1 = sd(residual_safe, na.rm = TRUE) / sqrt(n()),  # SE van residuals binnen groep
    n = n(),
    .groups = "drop"
  )
summary_preds_1
```


```{r}
ggplot(summary_preds_1, aes(x = leeftijd_, y = mean_pred_1, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_1 - se_pred_1,
                    ymax = mean_pred_1 + se_pred_1),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )



```





```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(Maihdab_safe_1, condVar = TRUE)$intersections

re_with_var <- ranef(Maihdab_safe_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```


```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "steelblue",
  re_df$significance == "Disadvantaged" ~ "tomato",
  TRUE ~ "black"
)

re_df
```


```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects"
  ) +
  theme_minimal()


```



```{r}
list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())

```
```{r}
list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```
```{r}
pred_df_1 <- NEA2022 %>%
  mutate(
    pred_1 = predict(Maihdab_safe_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_1 = mean(pred_1, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

```



```{r}
list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())

```
```{r}
list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```





OVERALL HIGHLY SAFE


```{r}
NEA2022$phighsafe <-pmodel7_bv6*100
```



```{r}
Maihdab_highsafe_0 <- lmer(phighsafe ~ 1 + (1|intersections), data=NEA2022) 
summary(Maihdab_highsafe_0)
confint(Maihdab_highsafe_0)
```
```{r}
Maihdab_highsafe_1 <- lmer(phighsafe ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=NEA2022)
summary(Maihdab_highsafe_1)
```

```{r}
tab_model(Maihdab_highsafe_0, Maihdab_highsafe_1, p.style="stars")
```



```{r}
library(dplyr)

NEA2022$predicted_highsafe <- predict(Maihdab_highsafe_1, re.form = NULL, type = "response")

```

```{r}
NEA2022$residual_highsafe <- NEA2022$phighsafe - NEA2022$predicted_highsafe

```

```{r}
summary_preds_1 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd_) %>%
  summarise(
    mean_pred_1 = mean(predicted_highsafe, na.rm = TRUE),
    se_pred_1 = sd(residual_highsafe, na.rm = TRUE) / sqrt(n()),  # SE van residuals binnen groep
    n = n(),
    .groups = "drop"
  )
summary_preds_1
```


```{r}
ggplot(summary_preds_1, aes(x = leeftijd_, y = mean_pred_1, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_1 - se_pred_1,
                    ymax = mean_pred_1 + se_pred_1),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )



```





```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(Maihdab_highsafe_1, condVar = TRUE)$intersections

re_with_var <- ranef(Maihdab_highsafe_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```


```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "steelblue",
  re_df$significance == "Disadvantaged" ~ "tomato",
  TRUE ~ "black"
)

re_df
```


```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects"
  ) +
  theme_minimal()


```



```{r}
list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())

```
```{r}
list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```
```{r}
pred_df_1 <- NEA2022 %>%
  mutate(
    pred_1 = predict(Maihdab_highsafe_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_1 = mean(pred_1, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

```



```{r}
list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())

```
```{r}
list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```




OVERALL UNSAFE


```{r}
NEA2022$punsafe <-pmodel7_bv7*100
```



```{r}
Maihdab_unsafe_0 <- lmer(punsafe ~ 1 + (1|intersections), data=NEA2022) 
summary(Maihdab_unsafe_0)
confint(Maihdab_unsafe_0)
```
```{r}
Maihdab_unsafe_1 <- lmer(punsafe ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=NEA2022)
summary(Maihdab_unsafe_1)
```

```{r}
tab_model(Maihdab_unsafe_0, Maihdab_unsafe_1, p.style="stars")
```



```{r}
library(dplyr)

NEA2022$predicted_unsafe <- predict(Maihdab_unsafe_1, re.form = NULL, type = "response")

```

```{r}
NEA2022$residual_unsafe <- NEA2022$punsafe - NEA2022$predicted_unsafe

```

```{r}
summary_preds_1 <- NEA2022 %>%
  group_by(gender, migration, education, leeftijd_) %>%
  summarise(
    mean_pred_1 = mean(predicted_unsafe, na.rm = TRUE),
    se_pred_1 = sd(residual_unsafe, na.rm = TRUE) / sqrt(n()),  # SE van residuals binnen groep
    n = n(),
    .groups = "drop"
  )
summary_preds_1
```


```{r}
ggplot(summary_preds_1, aes(x = leeftijd_, y = mean_pred_1, color = gender)) +
  geom_point() +   # geen position_dodge
  geom_errorbar(aes(ymin = mean_pred_1 - se_pred_1,
                    ymax = mean_pred_1 + se_pred_1),
                width = 0,
                alpha = 0.4,
                size = 0.005
                ) + 
  facet_grid(rows = vars(education), cols = vars(migration),
             labeller = labeller(
               education = education_labels,
               migration = migration_labels
             ),
             switch = "y"
  ) +
  labs(
    y = NULL,
    x = NULL,
    color = "Gender"
  ) +
  scale_color_manual(values = c("m" = "steelblue", "v" = "tomato"),
                     labels = gender_labels) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(angle = 90),
    strip.background = element_rect(fill = "gray90", color = NA),
    strip.placement = "outside",
    strip.text.y.left = element_text(angle = 0),
    axis.title.y = element_blank(),
    axis.text.y.left = element_blank(),
    axis.ticks.y.left = element_blank(),
    plot.margin = margin(10, 30, 10, 10)
  ) +
  scale_y_continuous(
    name = NULL,
    sec.axis = dup_axis(name = "Predicted Probability")
  )



```





```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(Maihdab_unsafe_1, condVar = TRUE)$intersections

re_with_var <- ranef(Maihdab_unsafe_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```


```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "steelblue",
  re_df$significance == "Disadvantaged" ~ "tomato",
  TRUE ~ "black"
)

re_df
```


```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects"
  ) +
  theme_minimal()


```



```{r}
list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())

```
```{r}
list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```
```{r}
pred_df_1 <- NEA2022 %>%
  mutate(
    pred_1 = predict(Maihdab_unsafe_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_1 = mean(pred_1, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

```



```{r}
list_1 <- pred_df_1 %>%
  arrange(desc(pred_mean_1)) %>%
  mutate(rank = row_number())

top10_1 <- list_1 %>% slice(1:10)
bottom10_1 <- list_1 %>% slice((n() - 9):n())

```
```{r}
list_1 <- bind_rows(
  top10_1 %>% mutate(type = "Top 10"),
  bottom10_1 %>% mutate(type = "Bottom 10")
)

print(list_1)

```







```{r}
mis_pestenleid <- NEA2022 %>%
  filter(!is.na(pesten_leid))
```

```{r}
L_pestleid_0 <- lmer(pesten_leid ~ 1 + (1|intersections), data=mis_pestenleid) 
                 
summary(L_pestleid_0)
```

```{r}
L_pestleid_1 <- lmer(pesten_leid ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=mis_pestenleid)
summary(L_pestleid_1)
```
```{r}
tab_model(L_pestleid_0, L_pestleid_1, p.style="stars")
```

```{r}
mis_pestenleid$predicted_pestleid <- predict(L_pestleid_1, type = "response")
```

```{r}
summary_preds_pestleid <- mis_pestenleid %>%
  group_by(gender, migration, education, leeftijd) %>%
  summarise(mean_pred_pestleid = mean(predicted_pestleid, na.rm = TRUE),
            se_pred_pestleid = sd(predicted_pestleid, na.rm = TRUE)/sqrt(n()),
            .groups = "drop")
```

```{r}
library(ggplot2)

ggplot(summary_preds_pestleid, aes(x = leeftijd, y = mean_pred_pestleid, color = gender)) +
  geom_point(position_pestleid = position_dodge(width = 0.5)) +
  geom_errorbar(aes(ymin = mean_pred_pestleid - se_pred_pestleid, ymax = mean_pred_pestleid + se_pred_pestleid),
                width = 0,
                position_pestleid = position_dodge(width = 0.5)) +
  facet_grid(education ~ migration) +
  labs(y = "Predicted Probability", x = "Age Group") +
  theme_minimal()

```
```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_pestleid_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_pestleid_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```
```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "blue",
  re_df$significance == "Disadvantaged" ~ "orange",
  TRUE ~ "black"
)

re_df
```
```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects (Random Intercepts)",
    title = "Estimated Intersectional Effects with 95% CI"
  ) +
  theme_minimal()


```
```{r}
pred_df_pestleid <- mis_pestenleid %>%
  mutate(
    pred_pestleid = predict(L_pestleid_0, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_pestleid = mean(pred_pestleid, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_pestleid)) %>%
  mutate(rank = row_number())

```



```{r}
list_pestleid <- pred_df_pestleid %>%
  arrange(desc(pred_mean_pestleid)) %>%
  mutate(rank = row_number())

top10_pestleid <- list_pestleid %>% slice(1:10)
bottom10_pestleid <- list_pestleid %>% slice((n() - 9):n())

```
```{r}
list_pestleid <- bind_rows(
  top10_pestleid %>% mutate(type = "Top 10"),
  bottom10_pestleid %>% mutate(type = "Bottom 10")
)

print(list_pestleid)

```
```{r}
pred_df_pestleid <- mis_pestenleid %>%
  mutate(
    pred_pestleid = predict(L_pestleid_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_pestleid = mean(pred_pestleid, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_pestleid)) %>%
  mutate(rank = row_number())

```



```{r}
list_pestleid <- pred_df_pestleid %>%
  arrange(desc(pred_mean_pestleid)) %>%
  mutate(rank = row_number())

top10_pestleid <- list_pestleid %>% slice(1:10)
bottom10_pestleid <- list_pestleid %>% slice((n() - 9):n())

```
```{r}
list_pestleid <- bind_rows(
  top10_pestleid %>% mutate(type = "Top 10"),
  bottom10_pestleid %>% mutate(type = "Bottom 10")
)

print(list_pestleid)

```


```{r}
L_pestleid_s <- lm(pesten_leid ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75, data=mis_pestenleid)
L_pestleid_s
```
```{r}
tab_model(L_pestleid_s, p.style="stars")
```




INTIMIDATION COWORKERS


```{r}
mis_intimidationcol <- NEA2022 %>%
  filter(!is.na(intimidation_col))
```


```{r}
L_intimidationcol_0 <- lmer(intimidation_col ~ 1 + (1|intersections), data=mis_intimidationcol) 
                 
summary(L_intimidationcol_0)
```


```{r}
L_intimidationcol_1 <- lmer(intimidation_col ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=mis_intimidationcol)
summary(L_intimidationcol_1)
```
```{r}
tab_model(L_intimidationcol_0, L_intimidationcol_1, p.style="stars")
```


```{r}
mis_intimidationcol$predicted_intimidationcol <- predict(L_intimidationcol_1, type = "response")
```

```{r}
summary_preds_intimidationcol <- mis_intimidationcol %>%
  group_by(gender, migration, education, leeftijd) %>%
  summarise(mean_pred_intimidationcol = mean(predicted_intimidationcol, na.rm = TRUE),
            se_pred_intimidationcol = sd(predicted_intimidationcol, na.rm = TRUE)/sqrt(n()),
            .groups = "drop")
```

```{r}
library(ggplot2)

ggplot(summary_preds_intimidationcol, aes(x = leeftijd, y = mean_pred_intimidationcol, color = gender)) +
  geom_point(position_intimidationcol = position_dodge(width = 0.5)) +
  geom_errorbar(aes(ymin = mean_pred_intimidationcol - se_pred_intimidationcol, ymax = mean_pred_intimidationcol + se_pred_intimidationcol),
                width = 0,
                position_intimidationcol = position_dodge(width = 0.5)) +
  facet_grid(education ~ migration) +
  labs(y = "Predicted Probability", x = "Age Group") +
  theme_minimal()

```
```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_intimidationcol_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_intimidationcol_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```
```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "blue",
  re_df$significance == "Disadvantaged" ~ "orange",
  TRUE ~ "black"
)

re_df
```
```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects (Random Intercepts)",
    title = "Estimated Intersectional Effects with 95% CI"
  ) +
  theme_minimal()


```

```{r}
pred_df_intimidationcol <- mis_intimidationcol %>%
  mutate(
    pred_intimidationcol = predict(L_intimidationcol_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_intimidationcol = mean(pred_intimidationcol, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_intimidationcol)) %>%
  mutate(rank = row_number())

```



```{r}
list_intimidationcol <- pred_df_intimidationcol %>%
  arrange(desc(pred_mean_intimidationcol)) %>%
  mutate(rank = row_number())

top10_intimidationcol <- list_intimidationcol %>% slice(1:10)
bottom10_intimidationcol <- list_intimidationcol %>% slice((n() - 9):n())

```
```{r}
list_intimidationcol <- bind_rows(
  top10_intimidationcol %>% mutate(type = "Top 10"),
  bottom10_intimidationcol %>% mutate(type = "Bottom 10")
)

print(list_intimidationcol)

```




INTIMIDATION SUPERVISORS

```{r}
mis_intimidationleid <- NEA2022 %>%
  filter(!is.na(intimidation_leid))
```


```{r}
L_intimidationleid_0 <- lmer(intimidation_leid ~ 1 + (1|intersections), data=mis_intimidationleid) 
                 
summary(L_intimidationleid_0)
```

```{r}
L_intimidationleid_1 <- lmer(intimidation_leid ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=mis_intimidationleid)
summary(L_intimidationleid_1)
```
```{r}
tab_model(L_intimidationleid_0, L_intimidationleid_1, p.style="stars")
```


```{r}
mis_intimidationleid$predicted_intimidationleid <- predict(L_intimidationleid_1, type = "response")
```

```{r}
summary_preds_intimidationleid <- mis_intimidationleid %>%
  group_by(gender, migration, education, leeftijd) %>%
  summarise(mean_pred_intimidationleid = mean(predicted_intimidationleid, na.rm = TRUE),
            se_pred_intimidationleid = sd(predicted_intimidationleid, na.rm = TRUE)/sqrt(n()),
            .groups = "drop")
```

```{r}
library(ggplot2)

ggplot(summary_preds_intimidationleid, aes(x = leeftijd, y = mean_pred_intimidationleid, color = gender)) +
  geom_point(position_intimidationleid = position_dodge(width = 0.5)) +
  geom_errorbar(aes(ymin = mean_pred_intimidationleid - se_pred_intimidationleid, ymax = mean_pred_intimidationleid + se_pred_intimidationleid),
                width = 0,
                position_intimidationleid = position_dodge(width = 0.5)) +
  facet_grid(education ~ migration) +
  labs(y = "Predicted Probability", x = "Age Group") +
  theme_minimal()

```
```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_intimidationleid_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_intimidationleid_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```
```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "blue",
  re_df$significance == "Disadvantaged" ~ "orange",
  TRUE ~ "black"
)

re_df
```
```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects (Random Intercepts)",
    title = "Estimated Intersectional Effects with 95% CI"
  ) +
  theme_minimal()


```



```{r}
pred_df_intimidationleid <- mis_intimidationleid %>%
  mutate(
    pred_intimidationleid = predict(L_intimidationleid_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_intimidationleid = mean(pred_intimidationleid, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_intimidationleid)) %>%
  mutate(rank = row_number())

```



```{r}
list_intimidationleid <- pred_df_intimidationleid %>%
  arrange(desc(pred_mean_intimidationleid)) %>%
  mutate(rank = row_number())

top10_intimidationleid <- list_intimidationleid %>% slice(1:10)
bottom10_intimidationleid <- list_intimidationleid %>% slice((n() - 9):n())

```
```{r}
list_intimidationleid <- bind_rows(
  top10_intimidationleid %>% mutate(type = "Top 10"),
  bottom10_intimidationleid %>% mutate(type = "Bottom 10")
)

print(list_intimidationleid)

```


UNWANTED SEXUAL ATTENTION COWORKERS


```{r}
mis_sekscol <- NEA2022 %>%
  filter(!is.na(seks_col))
```


```{r}
L_sekscol_0 <- lmer(seks_col ~ 1 + (1|intersections), data=mis_sekscol) 
                 
summary(L_sekscol_0)
```


```{r}
L_sekscol_1 <- lmer(seks_col ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=mis_sekscol)
summary(L_sekscol_1)
```
```{r}
tab_model(L_sekscol_0, L_sekscol_1, p.style="stars")
```



```{r}
mis_sekscol$predicted_sekscol <- predict(L_sekscol_1, type = "response")
```

```{r}
summary_preds_sekscol <- mis_sekscol %>%
  group_by(gender, migration, education, leeftijd) %>%
  summarise(mean_pred_sekscol = mean(predicted_sekscol, na.rm = TRUE),
            se_pred_sekscol = sd(predicted_sekscol, na.rm = TRUE)/sqrt(n()),
            .groups = "drop")
```

```{r}
library(ggplot2)

ggplot(summary_preds_sekscol, aes(x = leeftijd, y = mean_pred_sekscol, color = gender)) +
  geom_point(position_sekscol = position_dodge(width = 0.5)) +
  geom_errorbar(aes(ymin = mean_pred_sekscol - se_pred_sekscol, ymax = mean_pred_sekscol + se_pred_sekscol),
                width = 0,
                position_sekscol = position_dodge(width = 0.5)) +
  facet_grid(education ~ migration) +
  labs(y = "Predicted Probability", x = "Age Group") +
  theme_minimal()

```
```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_sekscol_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_sekscol_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```
```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "blue",
  re_df$significance == "Disadvantaged" ~ "orange",
  TRUE ~ "black"
)

re_df
```
```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects (Random Intercepts)",
    title = "Estimated Intersectional Effects with 95% CI"
  ) +
  theme_minimal()


```

```{r}
pred_df_sekscol <- mis_sekscol %>%
  mutate(
    pred_sekscol = predict(L_sekscol_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_sekscol = mean(pred_sekscol, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_sekscol)) %>%
  mutate(rank = row_number())

```



```{r}
list_sekscol <- pred_df_sekscol %>%
  arrange(desc(pred_mean_sekscol)) %>%
  mutate(rank = row_number())

top10_sekscol <- list_sekscol %>% slice(1:10)
bottom10_sekscol <- list_sekscol %>% slice((n() - 9):n())

```
```{r}
list_sekscol <- bind_rows(
  top10_sekscol %>% mutate(type = "Top 10"),
  bottom10_sekscol %>% mutate(type = "Bottom 10")
)

print(list_sekscol)

```

```{r}
table(mis_sekscol$intersections, mis_sekscol$seks_col)
```



UNWANTED SEXUAL ATTENTION SUPERVISORS

```{r}
mis_seksleid <- NEA2022 %>%
  filter(!is.na(seks_leid))
```


```{r}
L_seksleid_0 <- lmer(seks_leid ~ 1 + (1|intersections), data=mis_seksleid) 
                 
summary(L_seksleid_0)
```


```{r}
L_seksleid_1 <- lmer(seks_leid ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=mis_seksleid)
summary(L_seksleid_1)
```
```{r}
tab_model(L_seksleid_0, L_seksleid_1, p.style="stars")
```


```{r}
mis_seksleid$predicted_seksleid <- predict(L_seksleid_1, type = "response")
```

```{r}
summary_preds_seksleid <- mis_seksleid %>%
  group_by(gender, migration, education, leeftijd) %>%
  summarise(mean_pred_seksleid = mean(predicted_seksleid, na.rm = TRUE),
            se_pred_seksleid = sd(predicted_seksleid, na.rm = TRUE)/sqrt(n()),
            .groups = "drop")
```

```{r}
library(ggplot2)

ggplot(summary_preds_seksleid, aes(x = leeftijd, y = mean_pred_seksleid, color = gender)) +
  geom_point(position_seksleid = position_dodge(width = 0.5)) +
  geom_errorbar(aes(ymin = mean_pred_seksleid - se_pred_seksleid, ymax = mean_pred_seksleid + se_pred_seksleid),
                width = 0,
                position_seksleid = position_dodge(width = 0.5)) +
  facet_grid(education ~ migration) +
  labs(y = "Predicted Probability", x = "Age Group") +
  theme_minimal()

```


```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_seksleid_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_seksleid_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```
```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "blue",
  re_df$significance == "Disadvantaged" ~ "orange",
  TRUE ~ "black"
)

re_df
```
```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects (Random Intercepts)",
    title = "Estimated Intersectional Effects with 95% CI"
  ) +
  theme_minimal()


```


```{r}
pred_df_seksleid <- mis_seksleid %>%
  mutate(
    pred_seksleid = predict(L_seksleid_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_seksleid = mean(pred_seksleid, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_seksleid)) %>%
  mutate(rank = row_number())

```



```{r}
list_seksleid <- pred_df_seksleid %>%
  arrange(desc(pred_mean_seksleid)) %>%
  mutate(rank = row_number())

top10_seksleid <- list_seksleid %>% slice(1:10)
bottom10_seksleid <- list_seksleid %>% slice((n() - 9):n())

```
```{r}
list_seksleid <- bind_rows(
  top10_seksleid %>% mutate(type = "Top 10"),
  bottom10_seksleid %>% mutate(type = "Bottom 10")
)

print(list_seksleid)

```

```{r}
table(mis_seksleid$intersections, mis_seksleid$seks_leid)
```





PHYSICAL VIOLENCE COWORKERS

```{r}
mis_geweldcol <- NEA2022 %>%
  filter(!is.na(geweld_col))
```


```{r}
L_geweldcol_0 <- lmer(geweld_col ~ 1 + (1|intersections), data=mis_geweldcol) 
                 
summary(L_geweldcol_0)
```

```{r}
L_geweldcol_1 <- lmer(geweld_col ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=mis_geweldcol)
summary(L_geweldcol_1)
```

```{r}
tab_model(L_geweldcol_0, L_geweldcol_1, p.style="stars")
```


```{r}
mis_geweldcol$predicted_geweldcol <- predict(L_geweldcol_1, type = "response")
```

```{r}
summary_preds_geweldcol <- mis_geweldcol %>%
  group_by(gender, migration, education, leeftijd) %>%
  summarise(mean_pred_geweldcol = mean(predicted_geweldcol, na.rm = TRUE),
            se_pred_geweldcol = sd(predicted_geweldcol, na.rm = TRUE)/sqrt(n()),
            .groups = "drop")
```

```{r}
library(ggplot2)

ggplot(summary_preds_geweldcol, aes(x = leeftijd, y = mean_pred_geweldcol, color = gender)) +
  geom_point(position_geweldcol = position_dodge(width = 0.5)) +
  geom_errorbar(aes(ymin = mean_pred_geweldcol - se_pred_geweldcol, ymax = mean_pred_geweldcol + se_pred_geweldcol),
                width = 0,
                position_geweldcol = position_dodge(width = 0.5)) +
  facet_grid(education ~ migration) +
  labs(y = "Predicted Probability", x = "Age Group") +
  theme_minimal()

```
```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_geweldcol_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_geweldcol_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```
```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "blue",
  re_df$significance == "Disadvantaged" ~ "orange",
  TRUE ~ "black"
)

re_df
```
```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects (Random Intercepts)",
    title = "Estimated Intersectional Effects with 95% CI"
  ) +
  theme_minimal()


```

```{r}
pred_df_geweldcol <- mis_geweldcol %>%
  mutate(
    pred_geweldcol = predict(L_geweldcol_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_geweldcol = mean(pred_geweldcol, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_geweldcol)) %>%
  mutate(rank = row_number())

```



```{r}
list_geweldcol <- pred_df_geweldcol %>%
  arrange(desc(pred_mean_geweldcol)) %>%
  mutate(rank = row_number())

top10_geweldcol <- list_geweldcol %>% slice(1:10)
bottom10_geweldcol <- list_geweldcol %>% slice((n() - 9):n())

```
```{r}
list_geweldcol <- bind_rows(
  top10_geweldcol %>% mutate(type = "Top 10"),
  bottom10_geweldcol %>% mutate(type = "Bottom 10")
)

print(list_geweldcol)

```

PHYSICAL VIOLENCE SUPERVISORS

```{r}
mis_geweldleid <- NEA2022 %>%
  filter(!is.na(geweld_leid))
```



```{r}
L_geweldleid_0 <- lmer(geweld_leid ~ 1 + (1|intersections), data=mis_geweldleid) 
                 
summary(L_geweldleid_0)
```
```{r}
L_geweldleid_1 <- lmer(geweld_leid ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=mis_geweldleid)

summary(L_geweldleid_1)
```


```{r}
tab_model(L_geweldleid_0, L_geweldleid_1, p.style="stars")
```


```{r}
mis_geweldleid$predicted_geweldleid <- predict(L_geweldleid_1, type = "response")
```

```{r}
summary_preds_geweldleid <- mis_geweldleid %>%
  group_by(gender, migration, education, leeftijd) %>%
  summarise(mean_pred_geweldleid = mean(predicted_geweldleid, na.rm = TRUE),
            se_pred_geweldleid = sd(predicted_geweldleid, na.rm = TRUE)/sqrt(n()),
            .groups = "drop")
```

```{r}
library(ggplot2)

ggplot(summary_preds_geweldleid, aes(x = leeftijd, y = mean_pred_geweldleid, color = gender)) +
  geom_point(position_geweldleid = position_dodge(width = 0.5)) +
  geom_errorbar(aes(ymin = mean_pred_geweldleid - se_pred_geweldleid, ymax = mean_pred_geweldleid + se_pred_geweldleid),
                width = 0,
                position_geweldleid = position_dodge(width = 0.5)) +
  facet_grid(education ~ migration) +
  labs(y = "Predicted Probability", x = "Age Group") +
  theme_minimal()

```
```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_geweldleid_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_geweldleid_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```
```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```
```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "blue",
  re_df$significance == "Disadvantaged" ~ "orange",
  TRUE ~ "black"
)

re_df
```
```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects (Random Intercepts)",
    title = "Estimated Intersectional Effects with 95% CI"
  ) +
  theme_minimal()


```
```{r}
pred_df_geweldleid <- mis_geweldleid %>%
  mutate(
    pred_geweldleid = predict(L_geweldleid_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_geweldleid = mean(pred_geweldleid, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_geweldleid)) %>%
  mutate(rank = row_number())

```



```{r}
list_geweldleid <- pred_df_geweldleid %>%
  arrange(desc(pred_mean_geweldleid)) %>%
  mutate(rank = row_number())

top10_geweldleid <- list_geweldleid %>% slice(1:10)
bottom10_geweldleid <- list_geweldleid %>% slice((n() - 9):n())

```
```{r}
list_geweldleid <- bind_rows(
  top10_geweldleid %>% mutate(type = "Top 10"),
  bottom10_geweldleid %>% mutate(type = "Bottom 10")
)

print(list_geweldleid)

```



CONFLICT COWORKERS


```{r}
mis_conflictcol <- NEA2022 %>%
  filter(!is.na(conflict_col))
```


```{r}
L_conflictcol_0 <- lmer(conflict_col ~ 1 + (1|intersections), data=mis_conflictcol) 
                 
summary(L_conflictcol_0)
```

```{r}
L_conflictcol_1 <- lmer(conflict_col ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=mis_conflictcol)
summary(L_conflictcol_1)
```
```{r}
tab_model(L_conflictcol_0, L_conflictcol_1, p.style="stars")
```



```{r}
mis_conflictcol$predicted_conflictcol <- predict(L_conflictcol_1, type = "response")
```

```{r}
summary_preds_conflictcol <- mis_conflictcol %>%
  group_by(gender, migration, education, leeftijd) %>%
  summarise(mean_pred_conflictcol = mean(predicted_conflictcol, na.rm = TRUE),
            se_pred_conflictcol = sd(predicted_conflictcol, na.rm = TRUE)/sqrt(n()),
            .groups = "drop")
```

```{r}
library(ggplot2)

ggplot(summary_preds_conflictcol, aes(x = leeftijd, y = mean_pred_conflictcol, color = gender)) +
  geom_point(position_conflictcol = position_dodge(width = 0.5)) +
  geom_errorbar(aes(ymin = mean_pred_conflictcol - se_pred_conflictcol, ymax = mean_pred_conflictcol + se_pred_conflictcol),
                width = 0,
                position_conflictcol = position_dodge(width = 0.5)) +
  facet_grid(education ~ migration) +
  labs(y = "Predicted Probability", x = "Age Group") +
  theme_minimal()

```
```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_conflictcol_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_conflictcol_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```
```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "blue",
  re_df$significance == "Disadvantaged" ~ "orange",
  TRUE ~ "black"
)

re_df
```
```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects (Random Intercepts)",
    title = "Estimated Intersectional Effects with 95% CI"
  ) +
  theme_minimal()


```

```{r}
pred_df_conflictcol <- mis_conflictcol %>%
  mutate(
    pred_conflictcol = predict(L_conflictcol_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_conflictcol = mean(pred_conflictcol, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_conflictcol)) %>%
  mutate(rank = row_number())

```



```{r}
list_conflictcol <- pred_df_conflictcol %>%
  arrange(desc(pred_mean_conflictcol)) %>%
  mutate(rank = row_number())

top10_conflictcol <- list_conflictcol %>% slice(1:10)
bottom10_conflictcol <- list_conflictcol %>% slice((n() - 9):n())

```
```{r}
list_conflictcol <- bind_rows(
  top10_conflictcol %>% mutate(type = "Top 10"),
  bottom10_conflictcol %>% mutate(type = "Bottom 10")
)

print(list_conflictcol)

```




CONFLICT SUPERVISORS


```{r}
mis_conflictleid <- NEA2022 %>%
  filter(!is.na(conflict_leid))
```


```{r}
L_conflictleid_0 <- lmer(conflict_leid ~ 1 + (1|intersections), data=mis_conflictleid) 
                 
summary(L_conflictleid_0)
```

```{r}
L_conflictleid_1 <- lmer(conflict_leid ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=mis_conflictleid)
summary(L_conflictleid_1)
```
```{r}
tab_model(L_conflictleid_0, L_conflictleid_1, p.style="stars")
```



```{r}
mis_conflictleid$predicted_conflictleid <- predict(L_conflictleid_1, type = "response")
```

```{r}
summary_preds_conflictleid <- mis_conflictleid %>%
  group_by(gender, migration, education, leeftijd) %>%
  summarise(mean_pred_conflictleid = mean(predicted_conflictleid, na.rm = TRUE),
            se_pred_conflictleid = sd(predicted_conflictleid, na.rm = TRUE)/sqrt(n()),
            .groups = "drop")
```

```{r}
library(ggplot2)

ggplot(summary_preds_conflictleid, aes(x = leeftijd, y = mean_pred_conflictleid, color = gender)) +
  geom_point(position_conflictleid = position_dodge(width = 0.5)) +
  geom_errorbar(aes(ymin = mean_pred_conflictleid - se_pred_conflictleid, ymax = mean_pred_conflictleid + se_pred_conflictleid),
                width = 0,
                position_conflictleid = position_dodge(width = 0.5)) +
  facet_grid(education ~ migration) +
  labs(y = "Predicted Probability", x = "Age Group") +
  theme_minimal()

```
```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_conflictleid_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_conflictleid_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```
```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "blue",
  re_df$significance == "Disadvantaged" ~ "orange",
  TRUE ~ "black"
)

re_df
```
```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects (Random Intercepts)",
    title = "Estimated Intersectional Effects with 95% CI"
  ) +
  theme_minimal()


```

```{r}
pred_df_conflictleid <- mis_conflictleid %>%
  mutate(
    pred_conflictleid = predict(L_conflictleid_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_conflictleid = mean(pred_conflictleid, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_conflictleid)) %>%
  mutate(rank = row_number())

```



```{r}
list_conflictleid <- pred_df_conflictleid %>%
  arrange(desc(pred_mean_conflictleid)) %>%
  mutate(rank = row_number())

top10_conflictleid <- list_conflictleid %>% slice(1:10)
bottom10_conflictleid <- list_conflictleid %>% slice((n() - 9):n())

```
```{r}
list_conflictleid <- bind_rows(
  top10_conflictleid %>% mutate(type = "Top 10"),
  bottom10_conflictleid %>% mutate(type = "Bottom 10")
)

print(list_conflictleid)

```


INCIVILITY COWORKERS


```{r}
mis_steuncol <- NEA2022 %>%
  filter(!is.na(steuncol_RR))
```


```{r}
L_steuncol_0 <- lmer(steuncol_RR ~ 1 + (1|intersections), data=mis_steuncol) 
                 
summary(L_steuncol_0)
```

```{r}
L_steuncol_1 <- lmer(steuncol_RR ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=mis_steuncol)
summary(L_steuncol_1)
```
```{r}
tab_model(L_steuncol_0, L_steuncol_1, p.style="stars")
```



```{r}
mis_steuncol$predicted_steuncol <- predict(L_steuncol_1, type = "response")
```

```{r}
summary_preds_steuncol <- mis_steuncol %>%
  group_by(gender, migration, education, leeftijd) %>%
  summarise(mean_pred_steuncol = mean(predicted_steuncol, na.rm = TRUE),
            se_pred_steuncol = sd(predicted_steuncol, na.rm = TRUE)/sqrt(n()),
            .groups = "drop")
```

```{r}
library(ggplot2)

ggplot(summary_preds_steuncol, aes(x = leeftijd, y = mean_pred_steuncol, color = gender)) +
  geom_point(position_steuncol = position_dodge(width = 0.5)) +
  geom_errorbar(aes(ymin = mean_pred_steuncol - se_pred_steuncol, ymax = mean_pred_steuncol + se_pred_steuncol),
                width = 0,
                position_steuncol = position_dodge(width = 0.5)) +
  facet_grid(education ~ migration) +
  labs(y = "Predicted Probability", x = "Age Group") +
  theme_minimal()

```
```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_steuncol_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_steuncol_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```
```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "blue",
  re_df$significance == "Disadvantaged" ~ "orange",
  TRUE ~ "black"
)

re_df
```
```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects (Random Intercepts)",
    title = "Estimated Intersectional Effects with 95% CI"
  ) +
  theme_minimal()


```

```{r}
pred_df_steuncol <- mis_steuncol %>%
  mutate(
    pred_steuncol = predict(L_steuncol_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_steuncol = mean(pred_steuncol, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_steuncol)) %>%
  mutate(rank = row_number())

```



```{r}
list_steuncol <- pred_df_steuncol %>%
  arrange(desc(pred_mean_steuncol)) %>%
  mutate(rank = row_number())

top10_steuncol <- list_steuncol %>% slice(1:10)
bottom10_steuncol <- list_steuncol %>% slice((n() - 9):n())

```
```{r}
list_steuncol <- bind_rows(
  top10_steuncol %>% mutate(type = "Top 10"),
  bottom10_steuncol %>% mutate(type = "Bottom 10")
)

print(list_steuncol)

```





INCIVILITY SUPERVISORS 

```{r}
mis_steunleid <- NEA2022 %>%
  filter(!is.na(steunleid_RR))
```


```{r}
L_steunleid_0 <- lmer(steunleid_RR ~ 1 + (1|intersections), data=mis_steunleid) 
                 
summary(L_steunleid_0)
```

```{r}
L_steunleid_1 <- lmer(steunleid_RR ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=mis_steunleid)
summary(L_steunleid_1)
```
```{r}
tab_model(L_steunleid_0, L_steunleid_1, p.style="stars")
```



```{r}
mis_steunleid$predicted_steunleid <- predict(L_steunleid_1, type = "response")
```

```{r}
summary_preds_steunleid <- mis_steunleid %>%
  group_by(gender, migration, education, leeftijd) %>%
  summarise(mean_pred_steunleid = mean(predicted_steunleid, na.rm = TRUE),
            se_pred_steunleid = sd(predicted_steunleid, na.rm = TRUE)/sqrt(n()),
            .groups = "drop")
```

```{r}
library(ggplot2)

ggplot(summary_preds_steunleid, aes(x = leeftijd, y = mean_pred_steunleid, color = gender)) +
  geom_point(position_steunleid = position_dodge(width = 0.5)) +
  geom_errorbar(aes(ymin = mean_pred_steunleid - se_pred_steunleid, ymax = mean_pred_steunleid + se_pred_steunleid),
                width = 0,
                position_steunleid = position_dodge(width = 0.5)) +
  facet_grid(education ~ migration) +
  labs(y = "Predicted Probability", x = "Age Group") +
  theme_minimal()

```
```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_steunleid_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_steunleid_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```
```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "blue",
  re_df$significance == "Disadvantaged" ~ "orange",
  TRUE ~ "black"
)

re_df
```
```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects (Random Intercepts)",
    title = "Estimated Intersectional Effects with 95% CI"
  ) +
  theme_minimal()


```

```{r}
pred_df_steunleid <- mis_steunleid %>%
  mutate(
    pred_steunleid = predict(L_steunleid_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_steunleid = mean(pred_steunleid, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_steunleid)) %>%
  mutate(rank = row_number())

```



```{r}
list_steunleid <- pred_df_steunleid %>%
  arrange(desc(pred_mean_steunleid)) %>%
  mutate(rank = row_number())

top10_steunleid <- list_steunleid %>% slice(1:10)
bottom10_steunleid <- list_steunleid %>% slice((n() - 9):n())

```
```{r}
list_steunleid <- bind_rows(
  top10_steunleid %>% mutate(type = "Top 10"),
  bottom10_steunleid %>% mutate(type = "Bottom 10")
)

print(list_steunleid)

```





PSYCHOLOGICAL UNSAFETY


```{r}
mis_psyveil <- NEA2022 %>%
  filter(!is.na(psyveil_RR))
```


```{r}
L_psyveil_0 <- lmer(psyveil_RR ~ 1 + (1|intersections), data=mis_psyveil) 
                 
summary(L_psyveil_0)
```

```{r}
L_psyveil_1 <- lmer(psyveil_RR ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75  + (1 | intersections), data=mis_psyveil)
summary(L_psyveil_1)
```
```{r}
tab_model(L_psyveil_0, L_psyveil_1, p.style="stars")
```


```{r}
mis_psyveil$predicted_psyveil <- predict(L_psyveil_1, type = "response")
```

```{r}
summary_preds_psyveil <- mis_psyveil %>%
  group_by(gender, migration, education, leeftijd) %>%
  summarise(mean_pred_psyveil = mean(predicted_psyveil, na.rm = TRUE),
            se_pred_psyveil = sd(predicted_psyveil, na.rm = TRUE)/sqrt(n()),
            .groups = "drop")
```

```{r}
library(ggplot2)

ggplot(summary_preds_psyveil, aes(x = leeftijd, y = mean_pred_psyveil, color = gender)) +
  geom_point(position_psyveil = position_dodge(width = 0.5)) +
  geom_errorbar(aes(ymin = mean_pred_psyveil - se_pred_psyveil, ymax = mean_pred_psyveil + se_pred_psyveil),
                width = 0,
                position_psyveil = position_dodge(width = 0.5)) +
  facet_grid(education ~ migration) +
  labs(y = "Predicted Probability", x = "Age Group") +
  theme_minimal()

```
```{r}
# Haal de random intercepts (blup's) en SE's op
re <- ranef(L_psyveil_1, condVar = TRUE)$intersections

re_with_var <- ranef(L_psyveil_1, condVar = TRUE)
str(re_with_var)


# Bewaar het postVar object
post_var <- attr(re_with_var$intersections, "postVar")

# Controleer de vorm:
dim(post_var)  # zou moeten teruggeven: [1 1 n_strata]

# Dan kun je de SEs pakken:
se <- sqrt(post_var[1, 1, ])


# Combineer in een dataframe
re_df <- data.frame(
  intersection = rownames(re),
  estimate = re[,1],
  se = se
)

```
```{r}
re_df <- re_df %>%
  mutate(
    lower = estimate - 1.96 * se,
    upper = estimate + 1.96 * se,
    significance = case_when(
      upper < 0 ~ "Advantaged",
      lower > 0 ~ "Disadvantaged",
      TRUE ~ "Not Significant"
    )
  )
re_df

```

```{r}
# Rangschikken op effect
re_df <- re_df %>%
  arrange(estimate) %>%
  mutate(rank = row_number())

# Kleuren toewijzen
re_df$color <- case_when(
  re_df$significance == "Advantaged" ~ "blue",
  re_df$significance == "Disadvantaged" ~ "orange",
  TRUE ~ "black"
)

re_df
```
```{r}
ggplot(re_df, aes(x = rank, y = estimate, color = color)) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  scale_color_identity() +
  labs(
    x = "Rank",
    y = "Intersectional Effects (Random Intercepts)",
    title = "Estimated Intersectional Effects with 95% CI"
  ) +
  theme_minimal()


```

```{r}
pred_df_psyveil <- mis_psyveil %>%
  mutate(
    pred_psyveil = predict(L_psyveil_1, re.form = NULL)
  ) %>%
  group_by(intersections) %>%
  summarise(
    pred_mean_psyveil = mean(pred_psyveil, na.rm = TRUE)
  ) %>%
  arrange(desc(pred_mean_psyveil)) %>%
  mutate(rank = row_number())

```



```{r}
list_psyveil <- pred_df_psyveil %>%
  arrange(desc(pred_mean_psyveil)) %>%
  mutate(rank = row_number())

top10_psyveil <- list_psyveil %>% slice(1:10)
bottom10_psyveil <- list_psyveil %>% slice((n() - 9):n())

```
```{r}
list_psyveil <- bind_rows(
  top10_psyveil %>% mutate(type = "Top 10"),
  bottom10_psyveil %>% mutate(type = "Bottom 10")
)

print(list_psyveil)

```


```{r}
L_psyveil_s <- lm(psyveil_RR ~ gender_v + migration_eu + migration_noeu + 
    education_laag + education_middel + leeftijd__35.55 + leeftijd__55.75, data=mis_psyveil)
L_psyveil_s
```
```{r}
tab_model(L_psyveil_s, p.style="stars")
```


```{r}

NEA2022$pmodel7_empv6_T <- (NEA2022$pmodel7_empv6 * (29923 - 1) + 0.5) / 29923

summary(NEA2022$pmodel7_empv6_T)
summary(NEA2022$pmodel7_empv6)
```


```{r}
flb_5_g <- glmmTMB(pmodel7_empv5_T ~ gender_v + (1 | intersections),
                  family = beta_family(link = "logit"),
                  data = NEA2022)
summary(flb_5_g)
```
```{r}
flb_5_m <- glmmTMB(pmodel7_empv5_T ~ migration_eu + migration_noeu + (1 | intersections),
                  family = beta_family(link = "logit"),
                  data = NEA2022)
summary(flb_5_m)
```
```{r}
flb_5_e <- glmmTMB(pmodel7_empv5_T ~ education_laag + education_middel + (1 | intersections),
                  family = beta_family(link = "logit"),
                  data = NEA2022)
summary(flb_5_e)
```
```{r}
flb_5_l <- glmmTMB(pmodel7_empv5_T ~ leeftijd_35.55 + leeftijd_55.75  + (1 | intersections),
                  family = beta_family(link = "logit"),
                  data = NEA2022)
summary(flb_5_l)
```






```{r}
ggplot(NEA2022, aes(x = model7_6)) +
  geom_histogram(aes(y = ..density..), bins = 30,
                 fill = "lightblue", color = "white") +
  stat_function(fun = dnorm,
                args = list(mean = mean(NEA2022$model7_6, na.rm = TRUE),
                            sd   = sd(NEA2022$model7_6, na.rm = TRUE)),
                color = "red", size = 1) +
  theme_minimal() +
  labs(title = "Verdeling van NEA2022$model7_6",
       x = "Waarde", y = "Dichtheid")


```

```{r}
ggplot(NEA2022, aes(x = model7_7)) +
  geom_histogram(aes(y = ..density..), bins = 30,
                 fill = "lightblue", color = "white") +
  stat_function(fun = dnorm,
                args = list(mean = mean(NEA2022$model7_7, na.rm = TRUE),
                            sd   = sd(NEA2022$model7_7, na.rm = TRUE)),
                color = "red", size = 1) +
  theme_minimal() +
  labs(title = "Verdeling van NEA2022$model7_7",
       x = "Waarde", y = "Dichtheid")


```



```{r}
tab <- tabyl(NEA2022, model7_bpred, pesten_col, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

tab

tab <- tabyl(NEA2022, model7_emppred, pesten_col, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

tab
```

```{r}
tab <- tabyl(NEA2022, model7_bpred, pesten_leid, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel

tab <- tabyl(NEA2022, model7_emppred, pesten_leid, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel


```

```{r}
tab <- tabyl(NEA2022, model7_bpred, intimidation_col, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel

tab <- tabyl(NEA2022, model7_emppred, intimidation_col, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel


```


```{r}
tab <- tabyl(NEA2022, model7_bpred, intimidation_leid, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel

tab <- tabyl(NEA2022, model7_emppred, intimidation_leid, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel


```



```{r}
tab <- tabyl(NEA2022, model7_bpred, seks_col, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel

tab <- tabyl(NEA2022, model7_emppred, seks_col, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel


```


```{r}
tab <- tabyl(NEA2022, model7_bpred, seks_leid, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel

tab <- tabyl(NEA2022, model7_emppred, seks_leid, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel


```


```{r}
tab <- tabyl(NEA2022, model7_bpred, geweld_col, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel

tab <- tabyl(NEA2022, model7_emppred, geweld_col, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel


```


```{r}
tab <- tabyl(NEA2022, model7_bpred, geweld_leid, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel

tab <- tabyl(NEA2022, model7_emppred, geweld_leid, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel


```


```{r}
tab <- tabyl(NEA2022, model7_bpred, conflict_col, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel

tab <- tabyl(NEA2022, model7_emppred, conflict_col, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel


```


```{r}
tab <- tabyl(NEA2022, model7_bpred, conflict_leid, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel

tab <- tabyl(NEA2022, model7_emppred, conflict_leid, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel


```





```{r}
tab <- tabyl(NEA2022, model7_bpred, steuncol_RR, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel

tab <- tabyl(NEA2022, model7_emppred, steuncol_RR, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel


```



```{r}
tab <- tabyl(NEA2022, model7_bpred, steunleid_RR, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel

tab <- tabyl(NEA2022, model7_emppred, steunleid_RR, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel


```


```{r}
tab <- tabyl(NEA2022, model7_bpred, psyveil_RR, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel

tab <- tabyl(NEA2022, model7_emppred, psyveil_RR, show_na = FALSE) %>%
  adorn_percentages("row") %>%          
  adorn_pct_formatting(digits = 2) %>%  
  adorn_ns(position = "front")          

library(knitr)
kable(tab, format = "pipe")   # maakt een nette tabel


```
