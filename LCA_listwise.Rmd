---
title: "LCA_schaal3_29923"
output: html_document
date: "2025-03-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache=TRUE, echo = TRUE)
```


```{r, globalsettings, echo=FALSE, warning=FALSE, results='hide'}
library(knitr)

knitr::opts_chunk$set(echo = TRUE)
opts_chunk$set(tidy.opts=list(width.cutoff=100),tidy=TRUE, warning = FALSE, message = FALSE,comment = "#>", cache=TRUE, class.source=c("test"), class.output=c("test2"))
options(width = 100)
rgl::setupKnitr()


colorize <- function(x, color) {sprintf("<span style='color: %s;'>%s</span>", color, x) }

```



```{r klippy20, echo=FALSE, include=TRUE}
klippy::klippy(position = c('top', 'right'))
#klippy::klippy(color = 'darkred')
#klippy::klippy(tooltip_message = 'Click to copy', tooltip_success = 'Done')
```


```{r loading packages}
library("formatR")
library("foreign")
library("ggplot2")
library("lme4")
library("poLCA")
library("reprex")
library("tidyr")
library("klippy")
library("dplyr")
library("haven")
library("psych")
```


<br><br> **Loading in the data**

```{r loading data, cache=TRUE, echo=FALSE, include=TRUE, results='hide', warning=FALSE, message=FALSE}
NEA2022 <-read.spss("data/processed/NEAfinal.sav", use.value.labels = T, to.data.frame = T)
attach(NEA2022)
set.seed(123)
```


```{r data items, cache=TRUE, warning=FALSE}
data_m <- data.frame(pesten_col, pesten_leid, intimidation_col, intimidation_leid, geweld_col, geweld_leid, seks_col, seks_leid, conflict_col, conflict_leid, steunleid_RR, steuncol_RR, psyveil_RR)

items_m <- cbind(pesten_col, pesten_leid, intimidation_col, intimidation_leid, geweld_col, geweld_leid, seks_col, seks_leid, conflict_col, conflict_leid, steunleid_RR, steuncol_RR, psyveil_RR) ~ 1
```
<br><br> Variabelen:

<br><br> Pesten_col: **Bullying coworkers.** (1) no, never (2) a few times (3) often (4) very often
<br><br> Pesten_leid: **Bullying supervisors.** (1) no, never (2) a few times (3) often (4) very often
<br><br> Intimidation_col: **Intimidation coworkers.** (1) no, never (2) a few times (3) often (4) very often
<br><br> Intimidation_leid: *Intimidation supervisors.* (1) no, never (2) a few times (3) often (4) very often
<br><br> Geweld_col: **Physical violence coworkers.** (1) no, never (2) a few times (3) often (4) very often
<br><br> Geweld_leid: **Physical violence supervisors.** (1) no, never (2) a few times (3) often (4) very often
<br><br> Seks_col: **Unwanted sexual attention coworkers.** (1) no, never (2) a few times (3) often (4) very often
<br><br> Seks_leid: **Unwanted sexual attention supervisors.** (1) no, never (2) a few times (3) often (4) very often
<br><br> Conflict_col: **Conflict coworkers.** (1) no (2) yes, short-term (3) yes, long-term
<br><br> Conflict_leid: **Conflict supervisors.** (1) no (2) yes, short-term (3) yes, long-term
<br><br> Steunleid_RR: **My supervisor pays attention to what I say.** **My supervisor pays attention to the well-being of the staff.** Mean score of the two items, rounded. (1) fully agree (2) agree (3) disagree (4) fully disagree
<br><br> Steuncol_RR: **My co-workers take personal interest in me.** **My co-workers are friendly.** Mean score of the two items, rounded. (1) fully agree (2) agree (3) disagree (4) fully disagree
<br><br> Psyveil_RR: **At my workplace it is possible to raise difficult questions.** **At my workplace it is easy to ask for help.** **At my workplace it is okay to make a mistake.** Mean score of the three items, rounded. (1) fully agree (2) agree (3) don't agree, don't disagree (4) disagree (5) fully disagree

<br><br> **Latent class analysis**

```{r model1, cache=TRUE}
model1_m <- poLCA(items_m, data_m, nclass = 1, maxiter = 5000, nrep = 10, graphs=FALSE, na.rm = TRUE)
```

```{r model2, cache=TRUE}
model2_m <- poLCA(items_m, data_m, nclass = 2, maxiter = 5000, nrep = 10, graphs=FALSE, na.rm = TRUE)
```

```{r model3, cache=TRUE}
model3_m <- poLCA(items_m, data_m, nclass = 3, maxiter = 5000, nrep = 10, graphs=FALSE, na.rm = TRUE)
```

```{r model4, cache=TRUE}
model4_m <- poLCA(items_m, data_m, nclass = 4, maxiter = 5000, nrep = 10, graphs=FALSE, na.rm = TRUE)
```

```{r model5, cache=TRUE}
model5_m <- poLCA(items_m, data_m, nclass = 5, maxiter = 5000, nrep = 10, graphs=FALSE, na.rm = TRUE)
```

```{r model6, cache=TRUE}
model6_m <- poLCA(items_m, data_m, nclass = 6, maxiter = 5000, nrep = 10, graphs=FALSE, na.rm = TRUE)
```

```{r model7, cache=TRUE}
model7_m <- poLCA(items_m, data_m, nclass = 7, maxiter = 5000, nrep = 10, graphs=FALSE, na.rm = TRUE)
```

```{r model8, cache=TRUE}
model8_m <- poLCA(items_m, data_m, nclass = 8, maxiter = 5000, nrep = 10, graphs=FALSE, na.rm = TRUE)
```

```{r model9, cache=TRUE}
model9_m <- poLCA(items_m, data_m, nclass = 9, maxiter = 5000, nrep = 10, graphs=FALSE, na.rm = TRUE)
```

```{r model10, cache=TRUE}
model10_m <- poLCA(items_m, data_m, nclass = 10, maxiter = 5000, nrep = 10, graphs=FALSE, na.rm = TRUE)
```

```{r model11, cache=TRUE}
model11_m <- poLCA(items_m, data_m, nclass = 11, maxiter = 5000, nrep = 10, graphs=FALSE, na.rm = TRUE)
```

```{r model12, cache=TRUE}
model12_m <- poLCA(items_m, data_m, nclass = 12, maxiter = 5000, nrep = 10, graphs=FALSE, na.rm = TRUE)
```

```{r model13, cache=TRUE}
model13_m <- poLCA(items_m, data_m, nclass = 13, maxiter = 5000, nrep = 10, graphs=FALSE, na.rm = TRUE)
```

```{r model14, cache=TRUE}
model14_m <- poLCA(items_m, data_m, nclass = 14, maxiter = 5000, nrep = 10, graphs=FALSE, na.rm = TRUE)
```

<br><br> **Saving the models**

```{r saving models}
model3_mpred <- model3_m$predclass
model3_mpost <- model3_m$posterior

lposteriorsmodel3_m <- as.list(as.data.frame(model3_mpost))

pmodel3_mv1 <- lposteriorsmodel3_m[[1]]
pmodel3_mv2 <- lposteriorsmodel3_m[[2]]
pmodel3_mv3 <- lposteriorsmodel3_m[[3]]

model4_mpred <- model4_m$predclass
model4_mpost <- model4_m$posterior

lposteriorsmodel4_m <- as.list(as.data.frame(model4_mpost))

pmodel4_mv1 <- lposteriorsmodel4_m[[1]]
pmodel4_mv2 <- lposteriorsmodel4_m[[2]]
pmodel4_mv3 <- lposteriorsmodel4_m[[3]]
pmodel4_mv4 <- lposteriorsmodel4_m[[4]]


model5_mpred <- model5_m$predclass
model5_mpost <- model5_m$posterior

lposteriorsmodel5_m <- as.list(as.data.frame(model5_mpost))

pmodel5_mv1 <- lposteriorsmodel5_m[[1]]
pmodel5_mv2 <- lposteriorsmodel5_m[[2]]
pmodel5_mv3 <- lposteriorsmodel5_m[[3]]
pmodel5_mv4 <- lposteriorsmodel5_m[[4]]
pmodel5_mv5 <- lposteriorsmodel5_m[[5]]

model6_mpred <- model6_m$predclass
model6_mpost <- model6_m$posterior

lposteriorsmodel6_m <- as.list(as.data.frame(model6_mpost))

pmodel6_mv1 <- lposteriorsmodel6_m[[1]]
pmodel6_mv2 <- lposteriorsmodel6_m[[2]]
pmodel6_mv3 <- lposteriorsmodel6_m[[3]]
pmodel6_mv4 <- lposteriorsmodel6_m[[4]]
pmodel6_mv5 <- lposteriorsmodel6_m[[5]]
pmodel6_mv6 <- lposteriorsmodel6_m[[6]]

model7_mpred <- model7_m$predclass
model7_mpost <- model7_m$posterior

lposteriorsmodel7_m <- as.list(as.data.frame(model7_mpost))

pmodel7_mv1 <- lposteriorsmodel7_m[[1]]
pmodel7_mv2 <- lposteriorsmodel7_m[[2]]
pmodel7_mv3 <- lposteriorsmodel7_m[[3]]
pmodel7_mv4 <- lposteriorsmodel7_m[[4]]
pmodel7_mv5 <- lposteriorsmodel7_m[[5]]
pmodel7_mv6 <- lposteriorsmodel7_m[[6]]
pmodel7_mv7 <- lposteriorsmodel7_m[[7]]

model8_mpred <- model8_m$predclass
model8_mpost <- model8_m$posterior

lposteriorsmodel8_m <- as.list(as.data.frame(model8_mpost))

pmodel8_mv1 <- lposteriorsmodel8_m[[1]]
pmodel8_mv2 <- lposteriorsmodel8_m[[2]]
pmodel8_mv3 <- lposteriorsmodel8_m[[3]]
pmodel8_mv4 <- lposteriorsmodel8_m[[4]]
pmodel8_mv5 <- lposteriorsmodel8_m[[5]]
pmodel8_mv6 <- lposteriorsmodel8_m[[6]]
pmodel8_mv7 <- lposteriorsmodel8_m[[7]]
pmodel8_mv8 <- lposteriorsmodel8_m[[8]]

model9_mpred <- model9_m$predclass
model9_mpost <- model9_m$posterior

lposteriorsmodel9_m <- as.list(as.data.frame(model9_mpost))

pmodel9_mv1 <- lposteriorsmodel9_m[[1]]
pmodel9_mv2 <- lposteriorsmodel9_m[[2]]
pmodel9_mv3 <- lposteriorsmodel9_m[[3]]
pmodel9_mv4 <- lposteriorsmodel9_m[[4]]
pmodel9_mv5 <- lposteriorsmodel9_m[[5]]
pmodel9_mv6 <- lposteriorsmodel9_m[[6]]
pmodel9_mv7 <- lposteriorsmodel9_m[[7]]
pmodel9_mv8 <- lposteriorsmodel9_m[[8]]
pmodel9_mv9 <- lposteriorsmodel9_m[[9]]

model10_mpred <- model10_m$predclass
model10_mpost <- model10_m$posterior

lposteriorsmodel10_m <- as.list(as.data.frame(model10_mpost))

pmodel10_mv1 <- lposteriorsmodel10_m[[1]]
pmodel10_mv2 <- lposteriorsmodel10_m[[2]]
pmodel10_mv3 <- lposteriorsmodel10_m[[3]]
pmodel10_mv4 <- lposteriorsmodel10_m[[4]]
pmodel10_mv5 <- lposteriorsmodel10_m[[5]]
pmodel10_mv6 <- lposteriorsmodel10_m[[6]]
pmodel10_mv7 <- lposteriorsmodel10_m[[7]]
pmodel10_mv8 <- lposteriorsmodel10_m[[8]]
pmodel10_mv9 <- lposteriorsmodel10_m[[9]]
pmodel10_mv10 <- lposteriorsmodel10_m[[10]]

model11_mpred <- model11_m$predclass
model11_mpost <- model11_m$posterior

lposteriorsmodel11_m <- as.list(as.data.frame(model11_mpost))

pmodel11_mv1 <- lposteriorsmodel11_m[[1]]
pmodel11_mv2 <- lposteriorsmodel11_m[[2]]
pmodel11_mv3 <- lposteriorsmodel11_m[[3]]
pmodel11_mv4 <- lposteriorsmodel11_m[[4]]
pmodel11_mv5 <- lposteriorsmodel11_m[[5]]
pmodel11_mv6 <- lposteriorsmodel11_m[[6]]
pmodel11_mv7 <- lposteriorsmodel11_m[[7]]
pmodel11_mv8 <- lposteriorsmodel11_m[[8]]
pmodel11_mv9 <- lposteriorsmodel11_m[[9]]
pmodel11_mv10 <- lposteriorsmodel11_m[[10]]
pmodel11_mv11 <- lposteriorsmodel11_m[[11]]

model12_mpred <- model12_m$predclass
model12_mpost <- model12_m$posterior

lposteriorsmodel12_m <- as.list(as.data.frame(model12_mpost))

pmodel12_mv1 <- lposteriorsmodel12_m[[1]]
pmodel12_mv2 <- lposteriorsmodel12_m[[2]]
pmodel12_mv3 <- lposteriorsmodel12_m[[3]]
pmodel12_mv4 <- lposteriorsmodel12_m[[4]]
pmodel12_mv5 <- lposteriorsmodel12_m[[5]]
pmodel12_mv6 <- lposteriorsmodel12_m[[6]]
pmodel12_mv7 <- lposteriorsmodel12_m[[7]]
pmodel12_mv8 <- lposteriorsmodel12_m[[8]]
pmodel12_mv9 <- lposteriorsmodel12_m[[9]]
pmodel12_mv10 <- lposteriorsmodel12_m[[10]]
pmodel12_mv11 <- lposteriorsmodel12_m[[11]]
pmodel12_mv12 <- lposteriorsmodel12_m[[12]]
```

```{r saving models2}
Models_m <- cbind (volgnumm, model3_mpred	,
                 pmodel3_mv1	,
                 pmodel3_mv2	,
                 pmodel3_mv3	,
                 model4_mpred	,
                 pmodel4_mv1	,
                 pmodel4_mv2	,
                 pmodel4_mv3	,
                 pmodel4_mv4	,
                 model5_mpred	,
                 pmodel5_mv1	,
                 pmodel5_mv2	,
                 pmodel5_mv3	,
                 pmodel5_mv4	,
                 pmodel5_mv5	,
                 model6_mpred	,
                 pmodel6_mv1	,
                 pmodel6_mv2	,
                 pmodel6_mv3	,
                 pmodel6_mv4	,
                 pmodel6_mv5	,
                 pmodel6_mv6	,
                 model7_mpred	,
                 pmodel7_mv1	,
                 pmodel7_mv2	,
                 pmodel7_mv3	,
                 pmodel7_mv4	,
                 pmodel7_mv5	,
                 pmodel7_mv6	,
                 pmodel7_mv7	,
                 model8_mpred	,
                 pmodel8_mv1	,
                 pmodel8_mv2	,
                 pmodel8_mv3	,
                 pmodel8_mv4	,
                 pmodel8_mv5	,
                 pmodel8_mv6	,
                 pmodel8_mv7	,
                 pmodel8_mv8 ,
                 model9_mpred	,
                 pmodel9_mv1	,
                 pmodel9_mv2	,
                 pmodel9_mv3	,
                 pmodel9_mv4	,
                 pmodel9_mv5	,
                 pmodel9_mv6	,
                 pmodel9_mv7	,
                 pmodel9_mv8	,
                 pmodel9_mv9 ,
                 model10_mpred	,
                 pmodel10_mv1 ,
                 pmodel10_mv2 ,
                 pmodel10_mv3 ,
                 pmodel10_mv4 ,
                 pmodel10_mv5 ,
                 pmodel10_mv6 ,
                 pmodel10_mv7 ,
                 pmodel10_mv8 ,
                 pmodel10_mv9 ,
                 pmodel10_mv10 ,
                 model11_mpred	,
                 pmodel11_mv1 ,
                 pmodel11_mv2 ,
                 pmodel11_mv3 ,
                 pmodel11_mv4 ,
                 pmodel11_mv5 ,
                 pmodel11_mv6 ,
                 pmodel11_mv7 ,
                 pmodel11_mv8 ,
                 pmodel11_mv9 ,
                 pmodel11_mv10 ,
                 pmodel11_mv11 ,
                 model12_mpred	,
                 pmodel12_mv1 ,
                 pmodel12_mv2 ,
                 pmodel12_mv3 ,
                 pmodel12_mv4 ,
                 pmodel12_mv5 ,
                 pmodel12_mv6 ,
                 pmodel12_mv7 ,
                 pmodel12_mv8 ,
                 pmodel12_mv9 ,
                 pmodel12_mv10 ,
                 pmodel12_mv11 ,
                 pmodel12_mv12  )
```


<br><br> **Testing the seperation between classes**

```{r post prob}
max_probs <- apply(model7_mpost, 1, max)

mean(max_probs)
median(max_probs)
min(max_probs)
max(max_probs)

K <- 7

mean_posteriors <- numeric(K)

for (k in 1:K) {
  idx <- which(model7_mpred == k)
  mean_posteriors[k] <- mean(model7_mpost[idx, k])
}

names(mean_posteriors) <- paste0("Class", 1:K)

mean_posteriors

ggplot(data.frame(max_probs = max_probs), aes(x = max_probs)) +
  geom_histogram(binwidth = 0.05, fill = "steelblue", color = "white") +
  geom_vline(aes(xintercept = mean(max_probs)), 
             color = "red", linetype = "dashed", linewidth = 1) +
  labs(title = "Distribution of maximum posterior probabilities",
       x = "Maximum posterior probability",
       y = "Number of respondents") +
  theme_minimal()
```



```{r entropy}
poLCA.entropy <- function(model) {
  P <- model$posterior
  entropy <- sum(-P * log(P), na.rm=TRUE) / (nrow(P) * log(ncol(P)))
  return(1 - entropy)
}
poLCA.entropy(model2_m)

poLCA.entropy <- function(model) {
  P <- model$posterior
  entropy <- sum(-P * log(P), na.rm=TRUE) / (nrow(P) * log(ncol(P)))
  return(1 - entropy)
}
poLCA.entropy(model3_m)

poLCA.entropy <- function(model) {
  P <- model$posterior
  entropy <- sum(-P * log(P), na.rm=TRUE) / (nrow(P) * log(ncol(P)))
  return(1 - entropy)
}
poLCA.entropy(model4_m)

poLCA.entropy <- function(model) {
  P <- model$posterior
  entropy <- sum(-P * log(P), na.rm=TRUE) / (nrow(P) * log(ncol(P)))
  return(1 - entropy)
}
poLCA.entropy(model5_m)

poLCA.entropy <- function(model) {
  P <- model$posterior
  entropy <- sum(-P * log(P), na.rm=TRUE) / (nrow(P) * log(ncol(P)))
  return(1 - entropy)
}
poLCA.entropy(model6_m)

poLCA.entropy <- function(model) {
  P <- model$posterior
  entropy <- sum(-P * log(P), na.rm=TRUE) / (nrow(P) * log(ncol(P)))
  return(1 - entropy)
}
poLCA.entropy(model7_m)

poLCA.entropy <- function(model) {
  P <- model$posterior
  entropy <- sum(-P * log(P), na.rm=TRUE) / (nrow(P) * log(ncol(P)))
  return(1 - entropy)
}
poLCA.entropy(model8_m)

poLCA.entropy <- function(model) {
  P <- model$posterior
  entropy <- sum(-P * log(P), na.rm=TRUE) / (nrow(P) * log(ncol(P)))
  return(1 - entropy)
}
poLCA.entropy(model9_m)

poLCA.entropy <- function(model) {
  P <- model$posterior
  entropy <- sum(-P * log(P), na.rm=TRUE) / (nrow(P) * log(ncol(P)))
  return(1 - entropy)
}
poLCA.entropy(model10_m)

poLCA.entropy <- function(model) {
  P <- model$posterior
  entropy <- sum(-P * log(P), na.rm=TRUE) / (nrow(P) * log(ncol(P)))
  return(1 - entropy)
}
poLCA.entropy(model11_m)

poLCA.entropy <- function(model) {
  P <- model$posterior
  entropy <- sum(-P * log(P), na.rm=TRUE) / (nrow(P) * log(ncol(P)))
  return(1 - entropy)
}
poLCA.entropy(model12_m)
```


<br><br> **Plotjes**



```{r plotjes}
#Recoding variables on scale from 0 to 1

NEA2022 <- NEA2022 %>%
  mutate(pesten_col_plot = recode(pesten_col, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))

NEA2022 <- NEA2022 %>%
  mutate(pesten_leid_plot = recode(pesten_leid, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))

NEA2022 <- NEA2022 %>%
  mutate(int_col_plot = recode(intimidation_col, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))

NEA2022 <- NEA2022 %>%
  mutate(int_leid_plot = recode(intimidation_leid, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))

NEA2022 <- NEA2022 %>%
  mutate(gew_col_plot = recode(geweld_col, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))

NEA2022 <- NEA2022 %>%
  mutate(gew_leid_plot = recode(geweld_leid, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))

NEA2022 <- NEA2022 %>%
  mutate(seks_col_plot = recode(seks_col, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))

NEA2022 <- NEA2022 %>%
  mutate(seks_leid_plot = recode(seks_leid, `1` = 0, `2` = 0.33, `3` = 0.67, `4` = 1))

NEA2022 <- NEA2022 %>%
  mutate(conflict_col_plot = recode(conflict_col, `1` = 0, `2` = 0.50, `3` = 1))

NEA2022 <- NEA2022 %>%
  mutate(conflict_leid_plot = recode(conflict_leid, `1` = 0, `2` = 0.50, `3` = 1))

NEA2022 <- NEA2022 %>%
  mutate(steunleid_plot = (steunleid_RR - 1) / 3)

NEA2022 <- NEA2022 %>%
  mutate(steuncol_plot = (steuncol_RR - 1) / 3)

NEA2022 <- NEA2022 %>%
  mutate(psyveil_plot = (psyveil_RR - 1) / 4)

```

```{r}
NEAm <- NEA2022[!is.na(NEA2022$model4_mpred), ]
```


<br><br> **4 class model**


```{r plot4}

NEA2022$model4_mpred <- model4_m$predclass
model4_mpred <- model4_m$predclass
table(model4_m$predclass)

vars <- c("pesten_col_plot", "pesten_leid_plot", "int_col_plot", "int_leid_plot",
          "gew_col_plot", "gew_leid_plot", "seks_col_plot", "seks_leid_plot",
          "conflict_col_plot", "conflict_leid_plot", 
          "steuncol_plot", "steunleid_plot", "psyveil_plot")

plot_data4 <- NEA2022 %>%
  pivot_longer(cols = all_of(vars), names_to = "indicator", values_to = "value") %>%
  group_by(model4_mpred, indicator) %>%
  summarise(mean_value = mean(value, na.rm = TRUE), .groups = "drop") %>%
  mutate(
    indicator   = factor(indicator, levels = vars),
    class_label = recode(as.character(model4_mpred), 
                         "1" = "1 (17.51%)", 
                         "2" = "2 (4.67%)", 
                         "3" = "3 (20.59%)", 
                         "4" = "4 (57.23%)")
  )%>% 
  mutate(class_label = factor(class_label,
                      levels = c("1 (17.51%)", "2 (4.67%)", "3 (20.59%)", "4 (57.23%)")))

indicator_labels <- c(
  "pesten_col_plot"    = "Bullying C",
  "pesten_leid_plot"   = "Bullying S",
  "int_col_plot"       = "Intimidation C",
  "int_leid_plot"      = "Intimidation S",
  "seks_col_plot"      = "Unwanted sexual attention C",
  "seks_leid_plot"     = "Unwanted sexual attention S",
  "gew_col_plot"       = "Violence C",
  "gew_leid_plot"      = "Violence S",
  "conflict_col_plot"  = "Conflict C",
  "conflict_leid_plot" = "Conflict S",
  "steuncol_plot"      = "Incivility C",
  "steunleid_plot"     = "Incivility S",
  "psyveil_plot"       = "Psychological unsafety"
)

ggplot(plot_data4, aes(x = indicator, y = mean_value,
                      color = class_label, group = class_label)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  scale_x_discrete(labels = indicator_labels) +
  scale_y_continuous(breaks = seq(0, 1, 0.1),
                     limits = c(0, 1),
                     expand = c(0,0)) +
  scale_color_manual(
    values = c(
      "1 (17.51%)"   = "#CC79A7",
      "2 (4.67%)"          = "#D55E00",
      "3 (20.59%)"   = "#0072B2",
      "4 (57.23%)" = "#56B4E9"
    )
  ) +
  labs(x = NULL, y = "Mean score", color = NULL) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 11)
  )

```




<br><br> **5 class model**


```{r plot5}
model5_mpred <- model5_m$predclass
NEA2022$model5_mpred <- model5_m$predclass
table(model5_m$predclass)
prop.table(table(model5_m$predclass)) * 100

table(model4_mpred, model5_mpred)

vars <- c("pesten_col_plot", "pesten_leid_plot", "int_col_plot", "int_leid_plot",
          "gew_col_plot", "gew_leid_plot", "seks_col_plot", "seks_leid_plot",
          "conflict_col_plot", "conflict_leid_plot", "steuncol_plot", 
          "steunleid_plot", "psyveil_plot")

plot_data5 <- NEA2022 %>%
  pivot_longer(cols = all_of(vars), names_to = "indicator", values_to = "value") %>%
  group_by(model5_mpred, indicator) %>%
  summarise(mean_value = mean(value, na.rm = TRUE), .groups = "drop") %>%
  mutate(
    indicator   = factor(indicator, levels = vars),
    class_label = recode(as.character(model5_mpred), 
                         "1" = "1 (13.73%)", 
                         "2" = "2 (2.74%)", 
                         "3" = "3 (57.64%)", 
                         "4" = "4 (5.40%)",
                         "5" = "5 (20.50%)")
  )%>% 
  mutate(class_label = factor(class_label,
                      levels = c("1 (13.73%)", "2 (2.74%)", "3 (57.64%)", "4 (5.40%)", "5 (20.50%)")))


indicator_labels <- c(
  "pesten_col_plot"    = "Bullying C",
  "pesten_leid_plot"   = "Bullying S",
  "int_col_plot"       = "Intimidation C",
  "int_leid_plot"      = "Intimidation S",
  "seks_col_plot"      = "Unwanted sexual attention C",
  "seks_leid_plot"     = "Unwanted sexual attention S",
  "gew_col_plot"       = "Violence C",
  "gew_leid_plot"      = "Violence S",
  "conflict_col_plot"  = "Conflict C",
  "conflict_leid_plot" = "Conflict S",
  "steuncol_plot"      = "Incivility C",
  "steunleid_plot"     = "Incivility S",
  "psyveil_plot"       = "Psychological unsafety"
)

ggplot(plot_data5, aes(x = indicator, y = mean_value,
                      color = class_label, group = class_label)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  scale_x_discrete(labels = indicator_labels) +
  scale_y_continuous(breaks = seq(0, 1, 0.1),
                     limits = c(0, 1),
                     expand = c(0,0)) +
  scale_color_manual(
    values = c(
      "1 (13.73%)"   = "#CC79A7",
      "2 (2.74%)"          = "#D55E00",
      "3 (57.64%)"   = "#56B4E9",
      "4 (5.40%)" = "#E69F00",
      "5 (20.50%)" = "#0072B2"
    )
  ) +
  labs(x = NULL, y = "Mean score", color = NULL) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 11)
  )

```



<br><br> **6 class model**


```{r plot6}
model6_mpred <- model6_m$predclass
NEA2022$model6_mpred <- model6_m$predclass
table(model6_m$predclass)
prop.table(table(model6_m$predclass)) * 100

table(model5_mpred, model6_mpred)

vars <- c("pesten_col_plot", "pesten_leid_plot", "int_col_plot", "int_leid_plot",
          "gew_col_plot", "gew_leid_plot", "seks_col_plot", "seks_leid_plot",
          "conflict_col_plot", "conflict_leid_plot", "steuncol_plot", 
          "steunleid_plot", "psyveil_plot")

plot_data6 <- NEA2022 %>%
  pivot_longer(cols = all_of(vars), names_to = "indicator", values_to = "value") %>%
  group_by(model6_mpred, indicator) %>%
  summarise(mean_value = mean(value, na.rm = TRUE), .groups = "drop") %>%
  mutate(
    indicator   = factor(indicator, levels = vars),
    class_label = recode(as.character(model6_mpred), 
                         "1" = "1 (4.75%)", 
                         "2" = "2 (13.96%)", 
                         "3" = "3 (57.46%)", 
                         "4" = "4 (1.59%)",
                         "5" = "5 (1.84%)",
                         "6" = "6 (20.41%)")
  )%>% 
  mutate(class_label = factor(class_label,
                      levels = c("1 (4.75%)", "2 (13.96%)", "3 (57.46%)", "4 (1.59%)", "5 (1.84%)", "6 (20.41%)")))


indicator_labels <- c(
  "pesten_col_plot"    = "Bullying C",
  "pesten_leid_plot"   = "Bullying S",
  "int_col_plot"       = "Intimidation C",
  "int_leid_plot"      = "Intimidation S",
  "seks_col_plot"      = "Unwanted sexual attention C",
  "seks_leid_plot"     = "Unwanted sexual attention S",
  "gew_col_plot"       = "Violence C",
  "gew_leid_plot"      = "Violence S",
  "conflict_col_plot"  = "Conflict C",
  "conflict_leid_plot" = "Conflict S",
  "steuncol_plot"      = "Incivility C",
  "steunleid_plot"     = "Incivility S",
  "psyveil_plot"       = "Psychological unsafety"
)

ggplot(plot_data6, aes(x = indicator, y = mean_value,
                      color = class_label, group = class_label)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  scale_x_discrete(labels = indicator_labels) +
  scale_y_continuous(breaks = seq(0, 1, 0.1),
                     limits = c(0, 1),
                     expand = c(0,0)) +
  scale_color_manual(
    values = c(
      "1 (4.75%)"   = "#E69F00",
      "2 (13.96%)"          = "#CC79A7",
      "3 (57.46%)"   = "#56B4E9",
      "4 (1.59%)" = "#000000",
      "5 (1.84%)" = "#D55E00",
      "6 (20.41%)" = "#0072B2"
    )
  ) +
  labs(x = NULL, y = "Mean score", color = NULL) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 11)
  )

```


<br><br> **7 class model**

```{r plot7}
model7_mpred <- model7_m$predclass
NEA2022$model7_mpred <- model7_m$predclass
table(model7_m$predclass)
prop.table(table(model7_m$predclass)) * 100

table(model6_mpred, model7_mpred)

vars <- c("pesten_col_plot", "pesten_leid_plot", "int_col_plot", "int_leid_plot",
          "gew_col_plot", "gew_leid_plot", "seks_col_plot", "seks_leid_plot",
          "conflict_col_plot", "conflict_leid_plot", "steuncol_plot", 
          "steunleid_plot", "psyveil_plot")

plot_data7 <- NEA2022 %>%
  pivot_longer(cols = all_of(vars), names_to = "indicator", values_to = "value") %>%
  group_by(model7_mpred, indicator) %>%
  summarise(mean_value = mean(value, na.rm = TRUE), .groups = "drop") %>%
  mutate(
    indicator   = factor(indicator, levels = vars),
    class_label = recode(as.character(model7_mpred),
                         "1" = "Short-term conflict (6.84%)",
                         "2" = "Overall safe (56.37%)",
                         "3" = "Overall highly safe (20.36%)",
                         "4" = "Supervisor unsafety (1.83%)",
                         "5" = "Unsafe social climate (10.20%)",
                         "6" = "Overall unsafe (1.55%)",
                         "7" = "Coworker unsafety (2.86%)")
  ) %>%
  mutate(class_label = factor(class_label,
                              levels = c("Overall highly safe (20.36%)", 
                                         "Overall safe (56.37%)",
                                         "Short-term conflict (6.84%)", 
                                         "Unsafe social climate (10.20%)", 
                                         "Coworker unsafety (2.86%)", 
                                         "Supervisor unsafety (1.83%)", 
                                         "Overall unsafe (1.55%)")))

indicator_labels <- c(
  "pesten_col_plot"    = "Bullying C",
  "pesten_leid_plot"   = "Bullying S",
  "int_col_plot"       = "Intimidation C",
  "int_leid_plot"      = "Intimidation S",
  "seks_col_plot"      = "Unwanted sexual attention C",
  "seks_leid_plot"     = "Unwanted sexual attention S",
  "gew_col_plot"       = "Violence C",
  "gew_leid_plot"      = "Violence S",
  "conflict_col_plot"  = "Conflict C",
  "conflict_leid_plot" = "Conflict S",
  "steuncol_plot"      = "Incivility C",
  "steunleid_plot"     = "Incivility S",
  "psyveil_plot"       = "Psychological unsafety"
)

ggplot(plot_data7, aes(x = indicator, y = mean_value,
                      color = class_label, group = class_label)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  scale_x_discrete(labels = indicator_labels) +
  scale_y_continuous(breaks = seq(0, 1, 0.1),
                     limits = c(0, 1),
                     expand = c(0,0)) +
  scale_color_manual(
    values = c(
      "Overall highly safe (20.36%)"   = "#0072B2",
      "Overall safe (56.37%)"          = "#56B4E9",
      "Short-term conflict (6.84%)"   = "#009E73",
      "Unsafe social climate (10.20%)" = "#CC79A7",
      "Coworker unsafety (2.86%)"     = "#E69F00",
      "Supervisor unsafety (1.83%)"   = "#D55E00",
      "Overall unsafe (1.55%)"        = "#000000" 
    )
  ) +
  labs(x = NULL, y = "Mean score", color = NULL) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 11)
  )
```

<br><br> **8 class model**


```{r plot8}
model8_mpred <- model8_m$predclass
NEA2022$model8_mpred <- model8_m$predclass
table(model8_m$predclass)
prop.table(table(model8_m$predclass)) * 100

table(model7_mpred, model8_mpred)

# Predicted classes toevoegen
model8_mpred <- model8_m$predclass
NEA2022$model8_mpred <- model8_mpred

# Tabel en percentages
table(model8_mpred)
prop.table(table(model8_mpred)) * 100

# Variabelen voor plotting
vars <- c("pesten_col_plot", "pesten_leid_plot", "int_col_plot", "int_leid_plot",
          "gew_col_plot", "gew_leid_plot", "seks_col_plot", "seks_leid_plot",
          "conflict_col_plot", "conflict_leid_plot", "steuncol_plot", 
          "steunleid_plot", "psyveil_plot")

# Data voor plot
plot_data8 <- NEA2022 %>%
  pivot_longer(cols = all_of(vars), names_to = "indicator", values_to = "value") %>%
  group_by(model8_mpred, indicator) %>%
  summarise(mean_value = mean(value, na.rm = TRUE), .groups = "drop") %>%
  mutate(
    indicator   = factor(indicator, levels = vars),
    class_label = recode(as.character(model8_mpred), 
                         "1" = "1 (2.69%)", 
                         "2" = "2 (55.04%)", 
                         "3" = "3 (2.52%)", 
                         "4" = "4 (10.19%)",
                         "5" = "5 (20.36%)",
                         "6" = "6 (6.91%)",
                         "7" = "7 (0.62%)",
                         "8" = "8 (1.67%)")
  ) %>% 
  mutate(class_label = factor(class_label,
                      levels = c("1 (2.69%)", "2 (55.04%)", "3 (2.52%)", "4 (10.19%)",
                                 "5 (20.36%)", "6 (6.91%)", "7 (0.62%)", "8 (1.67%)")))

# Labels voor indicatoren
indicator_labels <- c(
  "pesten_col_plot"    = "Bullying C",
  "pesten_leid_plot"   = "Bullying S",
  "int_col_plot"       = "Intimidation C",
  "int_leid_plot"      = "Intimidation S",
  "seks_col_plot"      = "Unwanted sexual attention C",
  "seks_leid_plot"     = "Unwanted sexual attention S",
  "gew_col_plot"       = "Violence C",
  "gew_leid_plot"      = "Violence S",
  "conflict_col_plot"  = "Conflict C",
  "conflict_leid_plot" = "Conflict S",
  "steuncol_plot"      = "Incivility C",
  "steunleid_plot"     = "Incivility S",
  "psyveil_plot"       = "Psychological unsafety"
)

# Plotten
ggplot(plot_data8, aes(x = indicator, y = mean_value,
                       color = class_label, group = class_label)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  scale_x_discrete(labels = indicator_labels) +
  scale_y_continuous(breaks = seq(0, 1, 0.1),
                     limits = c(0, 1),
                     expand = c(0,0)) +
  scale_color_manual(
    values = c(
      "1 (2.69%)"   = "#E69F00",
      "2 (55.04%)"  = "#56B4E9",
      "3 (2.52%)"   = "#F0E442",
      "4 (10.19%)"  = "#CC79A7",
      "5 (20.36%)"  = "#0072B2",
      "6 (6.91%)"   = "#009E73",
      "7 (0.62%)"   = "#D55E00",
      "8 (1.67%)"   = "#000000" 
    )
  ) +
  labs(x = NULL, y = "Mean score", color = NULL) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 11)
  )

```




<br><br> **9 class model**


```{r plot9}
model9_mpred <- model9_m$predclass
NEA2022$model9_mpred <- model9_m$predclass
table(model9_m$predclass)
prop.table(table(model9_m$predclass)) * 100

table(model8_mpred, model9_mpred)

# Predicted classes toevoegen
model9_mpred <- model9_m$predclass
NEA2022$model9_mpred <- model9_mpred

# Tabel en percentages
table(model9_mpred)
prop.table(table(model9_mpred)) * 100

# Variabelen voor plotting
vars <- c("pesten_col_plot", "pesten_leid_plot", "int_col_plot", "int_leid_plot",
          "gew_col_plot", "gew_leid_plot", "seks_col_plot", "seks_leid_plot",
          "conflict_col_plot", "conflict_leid_plot", "steuncol_plot", 
          "steunleid_plot", "psyveil_plot")

# Data voor plot
plot_data9 <- NEA2022 %>%
  pivot_longer(cols = all_of(vars), names_to = "indicator", values_to = "value") %>%
  group_by(model9_mpred, indicator) %>%
  summarise(mean_value = mean(value, na.rm = TRUE), .groups = "drop") %>%
  mutate(
    indicator   = factor(indicator, levels = vars),
    class_label = recode(as.character(model9_mpred), 
                         "1" = "1 (1.51%)", 
                         "2" = "2 (2.11%)", 
                         "3" = "3 (0.38%)", 
                         "4" = "4 (2.33%)",
                         "5" = "5 (55.46%)",
                         "6" = "6 (9.79%)",
                         "7" = "7 (0.98%)",
                         "8" = "8 (20.52%)",
                         "9" = "9 (6.92%)")
  ) %>% 
  mutate(class_label = factor(class_label,
                      levels = c("1 (1.51%)", "2 (2.11%)", "3 (0.38%)", "4 (2.33%)",
                                 "5 (55.46%)", "6 (9.79%)", "7 (0.98%)", "8 (20.52%)", "9 (6.92%)")))

# Labels voor indicatoren
indicator_labels <- c(
  "pesten_col_plot"    = "Bullying C",
  "pesten_leid_plot"   = "Bullying S",
  "int_col_plot"       = "Intimidation C",
  "int_leid_plot"      = "Intimidation S",
  "seks_col_plot"      = "Unwanted sexual attention C",
  "seks_leid_plot"     = "Unwanted sexual attention S",
  "gew_col_plot"       = "Violence C",
  "gew_leid_plot"      = "Violence S",
  "conflict_col_plot"  = "Conflict C",
  "conflict_leid_plot" = "Conflict S",
  "steuncol_plot"      = "Incivility C",
  "steunleid_plot"     = "Incivility S",
  "psyveil_plot"       = "Psychological unsafety"
)

# Plotten
ggplot(plot_data9, aes(x = indicator, y = mean_value,
                       color = class_label, group = class_label)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  scale_x_discrete(labels = indicator_labels) +
  scale_y_continuous(breaks = seq(0, 1, 0.1),
                     limits = c(0, 1),
                     expand = c(0,0)) +
  scale_color_manual(
    values = c(
      "1 (1.51%)"   = "#000000",
      "2 (2.11%)"   = "#E69F00",
      "3 (0.38%)"   = "#D55E00",
      "4 (2.33%)"   = "#F0E442",
      "5 (55.46%)"  = "#56B4E9",
      "6 (9.79%)"   = "#CC79A7",
      "7 (0.98%)"   = "#999999",
      "8 (20.52%)"  = "#0072B2",
      "9 (6.92%)"   = "#009E73"  # extra kleur voor klasse 9
    )
  ) +
  labs(x = NULL, y = "Mean score", color = NULL) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.text = element_text(size = 11)
  )

```